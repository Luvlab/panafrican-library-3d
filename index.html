<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Panafrican Library Will Not Be Colonized | Reading Room 3D</title>
    <meta name="description" content="A curatorial Reading Room conceived as a living archive of panafrican and diasporic publishing. Interactive 3D simulation.">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            overflow: hidden;
        }
        #canvas-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        #info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px;
            border-radius: 8px;
            max-width: 320px;
            z-index: 100;
            border: 1px solid rgba(255,255,255,0.1);
        }
        /* Mobile responsive styles */
        @media (max-width: 768px) {
            #info-panel {
                top: 10px;
                left: 10px;
                right: 10px;
                max-width: none;
                padding: 12px;
            }
            #info-panel h1 { font-size: 14px; }
            #info-panel h2 { font-size: 9px; margin-bottom: 10px; }
            #info-panel p { font-size: 11px; margin-bottom: 10px; }
            .room-btn { padding: 6px 10px; font-size: 10px; }
            #controls-panel {
                top: auto;
                bottom: 180px;
                right: 10px;
                left: 10px;
                max-height: 40vh;
                display: flex;
                flex-wrap: wrap;
                gap: 5px;
                padding: 10px;
            }
            .control-section {
                flex: 1 1 45%;
                min-width: 140px;
                margin-bottom: 5px;
                padding-bottom: 5px;
            }
            .control-btn { padding: 6px 8px; font-size: 10px; }
            .section-title { font-size: 9px; margin-bottom: 5px; }
            #dimensions-panel { display: none; }
            #credits {
                bottom: 10px;
                right: 10px;
                left: auto;
                padding: 8px 10px;
                font-size: 8px;
            }
            #help-text {
                bottom: 150px;
                font-size: 10px;
                padding: 6px 12px;
            }
            #toggle-btns {
                bottom: 100px;
                padding: 0 10px;
            }
            .toggle-btn { padding: 5px 8px; font-size: 9px; }
            #capture-btn {
                bottom: 60px;
                padding: 8px 15px;
                font-size: 11px;
            }
        }
        @media (max-width: 480px) {
            #info-panel {
                padding: 10px;
            }
            #info-panel h1 { font-size: 12px; }
            #info-panel p { display: none; }
            #controls-panel {
                max-height: 35vh;
            }
            .control-section { flex: 1 1 100%; }
            #credits { display: none; }
        }
        #info-panel h1 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        #info-panel h2 {
            font-size: 11px;
            font-weight: 400;
            color: #888;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        #info-panel p {
            font-size: 13px;
            line-height: 1.6;
            color: #ccc;
            margin-bottom: 15px;
        }
        .room-btn {
            display: inline-block;
            padding: 8px 14px;
            margin: 4px 4px 4px 0;
            background: rgba(100, 149, 237, 0.3);
            border: 1px solid cornflowerblue;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        .room-btn:hover {
            background: cornflowerblue;
        }
        #controls-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 15px;
            border-radius: 8px;
            z-index: 100;
            border: 1px solid rgba(255,255,255,0.1);
            max-height: 80vh;
            overflow-y: auto;
        }
        .control-section {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .control-section:last-child { border-bottom: none; }
        .section-title {
            font-size: 10px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .control-btn {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin: 4px 0;
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            text-align: left;
            transition: all 0.3s;
        }
        .control-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        .control-btn.active {
            background: rgba(100, 149, 237, 0.4);
            border: 1px solid cornflowerblue;
        }
        #dimensions-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.85);
            padding: 15px;
            border-radius: 8px;
            z-index: 100;
            border: 1px solid rgba(255,255,255,0.1);
            font-size: 11px;
            max-width: 420px;
        }
        #dimensions-panel h3 {
            font-size: 12px;
            margin-bottom: 10px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .dim-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .dim-row:last-child { border-bottom: none; }
        .dim-label { color: #888; }
        .dim-value { color: #fff; font-family: monospace; }
        #credits {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 12px 15px;
            border-radius: 8px;
            z-index: 100;
            border: 1px solid rgba(255,255,255,0.1);
            font-size: 10px;
            text-align: right;
        }
        #credits a { color: cornflowerblue; text-decoration: none; }
        #credits a:hover { text-decoration: underline; }
        #help-text {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            color: #888;
            z-index: 100;
        }
        #toggle-btns {
            position: absolute;
            bottom: 130px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            z-index: 100;
            max-width: 500px;
        }
        .toggle-btn {
            padding: 6px 12px;
            background: rgba(0,0,0,0.7);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }
        .toggle-btn.active {
            background: rgba(100, 149, 237, 0.5);
            border-color: cornflowerblue;
        }
        #capture-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background: cornflowerblue;
            border: none;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            z-index: 100;
        }
        .icon { margin-right: 6px; }
        #moodboard-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(calc(-50% + 80px));
            padding: 10px 20px;
            background: #8b2942;
            border: none;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            z-index: 100;
        }
        #moodboard-btn:hover { background: #a03050; }
        #capture-btn { transform: translateX(calc(-50% - 80px)); }
        .modal-hidden { display: none; }
        #moodboard-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            overflow-y: auto;
            padding: 40px 20px;
        }
        .modal-content {
            max-width: 900px;
            margin: 0 auto;
            background: #1a1a1a;
            border-radius: 12px;
            padding: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .modal-close {
            position: absolute;
            top: 20px;
            right: 30px;
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
        }
        .modal-content h2 {
            font-size: 24px;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .modal-content > p {
            color: #888;
            margin-bottom: 25px;
            font-size: 14px;
        }
        .moodboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        .moodboard-section {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 8px;
        }
        .moodboard-section h3 {
            font-size: 14px;
            color: cornflowerblue;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .image-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .ref-image {
            aspect-ratio: 4/3;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .ref-image span {
            background: rgba(0,0,0,0.6);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 11px;
        }
        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .color-swatch {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .color-swatch:hover { transform: scale(1.1); }
        .design-list {
            list-style: none;
            font-size: 13px;
            line-height: 2;
        }
        .layout-info p {
            font-size: 12px;
            line-height: 1.8;
            color: #ccc;
            margin-bottom: 10px;
        }
        @media (max-width: 768px) {
            #capture-btn, #moodboard-btn {
                transform: translateX(-50%);
                bottom: 20px;
            }
            #moodboard-btn { bottom: 60px; }
            .modal-content { padding: 20px; }
            .moodboard-grid { grid-template-columns: 1fr; }
        }
        /* Decorator Mode Styles */
        #decorator-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(calc(-50% + 180px));
            padding: 10px 20px;
            background: #20c997;
            border: none;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            z-index: 100;
        }
        #decorator-btn:hover { background: #1aa87c; }
        #decorator-panel {
            position: fixed;
            top: 0;
            right: -350px;
            width: 350px;
            height: 100%;
            background: rgba(20,20,20,0.98);
            z-index: 1001;
            transition: right 0.3s ease;
            overflow-y: auto;
            border-left: 1px solid rgba(255,255,255,0.1);
        }
        #decorator-panel.open { right: 0; }
        .decorator-header {
            padding: 20px;
            background: rgba(0,0,0,0.5);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .decorator-header h2 { font-size: 16px; margin: 0; }
        .decorator-close {
            background: none;
            border: none;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
        }
        .decorator-category {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .decorator-category h3 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #20c997;
            margin-bottom: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .decorator-category h3::after { content: 'â–¼'; font-size: 8px; }
        .decorator-category.collapsed h3::after { content: 'â–¶'; }
        .decorator-category.collapsed .item-grid { display: none; }
        .item-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        .item-card {
            background: rgba(255,255,255,0.08);
            border-radius: 6px;
            padding: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .item-card:hover { background: rgba(255,255,255,0.15); }
        .item-card.selected { border-color: #20c997; background: rgba(32,201,151,0.2); }
        .item-preview {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 4px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        .item-name {
            font-size: 9px;
            color: #ccc;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .decorator-actions {
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .decorator-action-btn {
            flex: 1 1 45%;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
        }
        .decorator-action-btn.primary { background: #20c997; color: #fff; }
        .decorator-action-btn.secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .decorator-action-btn:hover { opacity: 0.8; }
        .decorator-instructions {
            padding: 15px;
            background: rgba(0,0,0,0.3);
            font-size: 11px;
            color: #888;
            line-height: 1.6;
        }
        .decorator-instructions strong { color: #fff; }
        #selected-item-info {
            padding: 15px;
            background: rgba(32,201,151,0.1);
            border-top: 1px solid rgba(32,201,151,0.3);
            display: none;
        }
        #selected-item-info.visible { display: block; }
        #selected-item-info h4 { font-size: 12px; margin-bottom: 8px; }
        .item-controls {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        .item-control-btn {
            padding: 6px 10px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
        }
        .item-control-btn:hover { background: rgba(255,255,255,0.2); }
        .item-control-btn.danger { background: rgba(220,53,69,0.5); }
        .item-control-btn.danger:hover { background: rgba(220,53,69,0.7); }
        /* Wall art section special styling */
        .art-item-card {
            grid-column: span 2;
        }
        .art-item-card .item-preview {
            aspect-ratio: 4/3;
        }
        @media (max-width: 768px) {
            #decorator-btn { transform: translateX(-50%); bottom: 100px; }
            #decorator-panel { width: 100%; right: -100%; }
        }
        /* Admin Mode Styles */
        #admin-btn {
            position: absolute;
            top: 20px;
            right: 240px;
            padding: 8px 16px;
            background: rgba(139, 41, 66, 0.8);
            border: 1px solid #8b2942;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            z-index: 100;
        }
        #admin-btn:hover { background: #8b2942; }
        #admin-btn.logged-in { background: #20c997; border-color: #1aa87c; }
        #render-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(calc(-50% + 280px));
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            z-index: 100;
        }
        #render-btn:hover { opacity: 0.9; }
        #render-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        /* Login Modal */
        #login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        #login-modal.visible { display: flex; }
        .login-box {
            background: #1a1a1a;
            padding: 40px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        .login-box h2 { margin-bottom: 10px; font-size: 20px; }
        .login-box p { color: #888; margin-bottom: 25px; font-size: 13px; }
        .login-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
            margin-bottom: 15px;
        }
        .login-input:focus { outline: none; border-color: #8b2942; }
        .login-submit {
            width: 100%;
            padding: 12px;
            background: #8b2942;
            border: none;
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }
        .login-submit:hover { background: #a03050; }
        .login-cancel {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            margin-top: 10px;
        }
        .login-error { color: #dc3545; font-size: 12px; margin-top: 10px; }
        /* Admin Panel */
        #admin-panel {
            position: fixed;
            top: 0;
            left: -400px;
            width: 400px;
            height: 100%;
            background: rgba(20,20,20,0.98);
            z-index: 1500;
            transition: left 0.3s ease;
            overflow-y: auto;
            border-right: 1px solid rgba(255,255,255,0.1);
        }
        #admin-panel.open { left: 0; }
        .admin-header {
            padding: 20px;
            background: linear-gradient(135deg, #8b2942 0%, #5a1a2a 100%);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .admin-header h2 { font-size: 16px; margin: 0; }
        .admin-user { font-size: 11px; color: rgba(255,255,255,0.7); }
        .admin-close {
            background: none;
            border: none;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
        }
        .admin-tabs {
            display: flex;
            background: rgba(0,0,0,0.3);
        }
        .admin-tab {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: #888;
            font-size: 11px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .admin-tab:hover { color: #fff; }
        .admin-tab.active { color: #fff; border-bottom-color: #8b2942; }
        .admin-content { padding: 20px; }
        .admin-section {
            margin-bottom: 25px;
        }
        .admin-section h3 {
            font-size: 12px;
            color: #8b2942;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }
        .admin-input-group {
            margin-bottom: 12px;
        }
        .admin-input-group label {
            display: block;
            font-size: 11px;
            color: #888;
            margin-bottom: 5px;
        }
        .admin-input {
            width: 100%;
            padding: 10px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 4px;
            color: #fff;
            font-size: 12px;
        }
        .admin-input:focus { outline: none; border-color: #8b2942; }
        .admin-textarea {
            min-height: 80px;
            resize: vertical;
        }
        .admin-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        .admin-btn-primary { background: #8b2942; color: #fff; }
        .admin-btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .admin-btn-success { background: #20c997; color: #fff; }
        .admin-btn:hover { opacity: 0.8; }
        .saved-config-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .saved-config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
            margin-bottom: 8px;
        }
        .saved-config-item:hover { background: rgba(255,255,255,0.1); }
        .saved-config-name { font-size: 12px; }
        .saved-config-meta { font-size: 10px; color: #888; }
        .saved-config-actions { display: flex; gap: 5px; }
        .saved-config-btn {
            padding: 4px 8px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 3px;
            color: #fff;
            font-size: 10px;
            cursor: pointer;
        }
        .saved-config-btn.danger { background: rgba(220,53,69,0.5); }
        /* Render Modal */
        #render-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        #render-modal.visible { display: flex; }
        .render-box {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .render-box h2 { margin-bottom: 5px; }
        .render-box > p { color: #888; margin-bottom: 20px; font-size: 13px; }
        .render-preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .render-preview-box {
            background: rgba(0,0,0,0.5);
            border-radius: 8px;
            padding: 15px;
        }
        .render-preview-box h4 {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 10px;
        }
        .render-preview-img {
            width: 100%;
            aspect-ratio: 16/10;
            background: #000;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #444;
            font-size: 12px;
            overflow: hidden;
        }
        .render-preview-img img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .render-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .render-style-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        .render-style-btn {
            padding: 10px;
            background: rgba(255,255,255,0.08);
            border: 2px solid transparent;
            border-radius: 6px;
            color: #fff;
            font-size: 10px;
            cursor: pointer;
            text-align: center;
        }
        .render-style-btn:hover { background: rgba(255,255,255,0.15); }
        .render-style-btn.active { border-color: #667eea; background: rgba(102,126,234,0.2); }
        .render-actions {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        .render-btn-generate {
            flex: 1;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }
        .render-btn-generate:disabled { opacity: 0.5; cursor: not-allowed; }
        .render-btn-close {
            padding: 14px 24px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }
        .render-status {
            text-align: center;
            padding: 20px;
            color: #888;
            font-size: 13px;
        }
        .render-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 768px) {
            #admin-btn { right: 10px; top: auto; bottom: 140px; }
            #render-btn { transform: translateX(-50%); bottom: 180px; }
            #admin-panel { width: 100%; left: -100%; }
            .render-preview { grid-template-columns: 1fr; }
            .render-options { grid-template-columns: 1fr; }
            .render-style-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <div id="info-panel">
        <h1>The Panafrican Library Will Not Be Colonized</h1>
        <h2>Reading Room â€¢ Interactive 3D</h2>
        <p>A curatorial Reading Room conceived as a living archive of panafrican and diasporic publishing. A space to read, listen, and slow down.</p>
        <button class="room-btn" onclick="focusRoom('roomS202')">Room S202 â€” Special Special</button>
        <button class="room-btn" onclick="focusRoom('roomS203')">Room S203 â€” Reading Room</button>
    </div>

    <div id="controls-panel">
        <div class="control-section">
            <div class="section-title">Overview</div>
            <button class="control-btn" onclick="setView('overview')"><span class="icon">ğŸ </span>Bird's Eye</button>
            <button class="control-btn" onclick="setView('floorPlan')"><span class="icon">ğŸ“</span>Floor Plan View</button>
        </div>
        <div class="control-section">
            <div class="section-title">Room S202 - Special Special</div>
            <button class="control-btn" onclick="setView('roomS202Entry')"><span class="icon">ğŸšª</span>Entry Vestibule</button>
            <button class="control-btn" onclick="setView('roomS202Inside')"><span class="icon">ğŸ”Š</span>Inside View</button>
            <button class="control-btn" onclick="setView('roomS202Windows')"><span class="icon">ğŸªŸ</span>Window Wall</button>
            <button class="control-btn" onclick="setView('roomS202Table')"><span class="icon">ğŸ“š</span>Display Table</button>
        </div>
        <div class="control-section">
            <div class="section-title">Room S203 - Reading Room</div>
            <button class="control-btn" onclick="setView('roomS203Entry')"><span class="icon">ğŸšª</span>Entry (from door)</button>
            <button class="control-btn" onclick="setView('roomS203Inside')"><span class="icon">ğŸ“–</span>Inside View</button>
            <button class="control-btn" onclick="setView('roomS203Windows')"><span class="icon">ğŸªŸ</span>Arched Windows</button>
            <button class="control-btn" onclick="setView('roomS203Seating')"><span class="icon">ğŸ›‹ï¸</span>Seating Area</button>
            <button class="control-btn" onclick="setView('roomS203Shelves')"><span class="icon">ğŸ“š</span>Book Displays</button>
        </div>
        <div class="control-section">
            <button class="control-btn" onclick="startTour()"><span class="icon">ğŸ¬</span>Auto Tour</button>
        </div>
    </div>

    <div id="dimensions-panel">
        <h3>Room Dimensions (from floor plan)</h3>
        <div class="dim-row">
            <span class="dim-label">Room S202 (Special Special)</span>
            <span class="dim-value">11'-5â…" Ã— 25'-3Â¾" | 3.49m Ã— 7.71m</span>
        </div>
        <div class="dim-row">
            <span class="dim-label">Room S202 Area</span>
            <span class="dim-value">289.4 sq ft | 26.9 mÂ²</span>
        </div>
        <div class="dim-row">
            <span class="dim-label">Room S203 (Reading Room)</span>
            <span class="dim-value">14'-7Â¾" Ã— 25'-3Â¾" | 4.46m Ã— 7.71m</span>
        </div>
        <div class="dim-row">
            <span class="dim-label">Room S203 Area</span>
            <span class="dim-value">369.5 sq ft | 34.3 mÂ²</span>
        </div>
        <div class="dim-row">
            <span class="dim-label">Ceiling Height</span>
            <span class="dim-value">12'-0" | 3.66m</span>
        </div>
        <div class="dim-row">
            <span class="dim-label">Door Openings</span>
            <span class="dim-value">3'-5â…›" Ã— 7'-0" | 1.04m Ã— 2.13m</span>
        </div>
        <div class="dim-row">
            <span class="dim-label">Total Combined Area</span>
            <span class="dim-value">658.9 sq ft | 61.2 mÂ²</span>
        </div>
    </div>

    <div id="credits">
        <div style="margin-bottom: 8px; color: #888;">A project by</div>
        <div><a href="http://www.afrikadaa.com/" target="_blank">Pascale Obolo / Afrikadaa</a></div>
        <div><a href="http://coolhuntparis.com" target="_blank">Nalini Cazaux / Coolhunt Paris</a></div>
        <div style="margin-top: 8px; color: #888;">3D Simulation by</div>
        <div><a href="http://luvlab.io" target="_blank">Gordon Cyrus / Luvlab</a></div>
    </div>

    <div id="help-text">â€¢ Drag to rotate â€¢ Scroll to zoom â€¢ WASD to move</div>

    <div id="toggle-btns">
        <button class="toggle-btn active" onclick="toggleGrid()" id="gridBtn">Grid</button>
        <button class="toggle-btn active" onclick="toggleLabels()" id="labelsBtn">Labels</button>
        <button class="toggle-btn active" onclick="toggleCeiling()" id="ceilingBtn">Ceiling</button>
        <button class="toggle-btn" onclick="toggleNearWall()" id="nearWallBtn">Hide Near Wall</button>
        <button class="toggle-btn" onclick="toggleWireframe()" id="wireframeBtn">Wireframe</button>
    </div>

    <button id="capture-btn" onclick="captureScreenshot()">ğŸ“· Capture</button>
    <button id="moodboard-btn" onclick="toggleMoodboard()">ğŸ¨ Mood Board</button>

    <!-- Mood Board Modal -->
    <div id="moodboard-modal" class="modal-hidden">
        <div class="modal-content">
            <button class="modal-close" onclick="toggleMoodboard()">âœ•</button>
            <h2>Reference Images & Mood Board</h2>
            <p>Design inspiration for The Panafrican Library Reading Room â€” Afrikadaa Ã— Coolhunt Paris</p>
            <div class="moodboard-grid">
                <div class="moodboard-section">
                    <h3>ğŸ¨ Color Palette</h3>
                    <p style="font-size: 11px; color: #666; margin-bottom: 8px;">Based on Panafrican reference imagery</p>
                    <div class="color-palette">
                        <div class="color-swatch" style="background: #f5f0e8;" title="Cream/Off-White (Bean Bags, Walls)"></div>
                        <div class="color-swatch" style="background: #fd7e14;" title="Burnt Orange (Bean Bags, Accents)"></div>
                        <div class="color-swatch" style="background: #c41e3a;" title="Deep Red (Natte, Posters)"></div>
                        <div class="color-swatch" style="background: #fdd835;" title="Bright Yellow (Wax Print, Highlights)"></div>
                        <div class="color-swatch" style="background: #c2185b;" title="Magenta/Pink (Cushions, Rugs)"></div>
                        <div class="color-swatch" style="background: #6b8e23;" title="Olive Green (Velvet Sofa)"></div>
                        <div class="color-swatch" style="background: #00897b;" title="Teal (Cushions, Accents)"></div>
                        <div class="color-swatch" style="background: #1a3a5c;" title="Deep Blue (Tie-Dye, Books)"></div>
                        <div class="color-swatch" style="background: #d4a76a;" title="Natural Wood/Rattan"></div>
                        <div class="color-swatch" style="background: #8b4513;" title="Terracotta/Brown"></div>
                        <div class="color-swatch" style="background: #c9a227;" title="Ochre/Gold"></div>
                        <div class="color-swatch" style="background: #1a1a1a;" title="Black (Frames, Contrast)"></div>
                    </div>
                </div>
                <div class="moodboard-section">
                    <h3>ğŸŒ African Wax Patterns</h3>
                    <div class="pattern-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                        <div class="pattern-swatch" style="background: repeating-conic-gradient(from 0deg, #fdd835 0deg 30deg, #c41e3a 30deg 60deg); width: 60px; height: 60px; border-radius: 4px;" title="Ankara Circles"></div>
                        <div class="pattern-swatch" style="background: repeating-linear-gradient(45deg, #fd7e14 0px, #fd7e14 10px, #fdd835 10px, #fdd835 20px); width: 60px; height: 60px; border-radius: 4px;" title="Kente Stripes"></div>
                        <div class="pattern-swatch" style="background: radial-gradient(circle at 50% 50%, #c41e3a 30%, #1a1a1a 30%, #1a1a1a 40%, #fdd835 40%); width: 60px; height: 60px; border-radius: 4px;" title="Target Circles"></div>
                        <div class="pattern-swatch" style="background: repeating-linear-gradient(0deg, #00897b 0px, #00897b 8px, #f5f0e8 8px, #f5f0e8 16px); width: 60px; height: 60px; border-radius: 4px;" title="Horizontal Bars"></div>
                        <div class="pattern-swatch" style="background: conic-gradient(#c2185b, #fdd835, #00897b, #c41e3a, #c2185b); width: 60px; height: 60px; border-radius: 4px;" title="Color Wheel"></div>
                        <div class="pattern-swatch" style="background: repeating-conic-gradient(#1a1a1a 0deg 10deg, #f5f0e8 10deg 20deg); width: 60px; height: 60px; border-radius: 4px;" title="B&W Geometric"></div>
                    </div>
                    <p style="font-size: 10px; color: #888; margin-top: 6px;">Ankara â€¢ Kente â€¢ Adinkra â€¢ Mud Cloth</p>
                </div>
                <div class="moodboard-section">
                    <h3>ğŸ›‹ï¸ Key Furniture (African-Inspired)</h3>
                    <ul class="design-list" style="font-size: 12px;">
                        <li>â–³ Large flat bean bags (cream, magenta, orange)</li>
                        <li>ğŸ§µ Nattes plastiques (Senegalese woven mats)</li>
                        <li>ğŸŸ« Built-in wooden platforms for seating</li>
                        <li>ğŸ’ Colorful floor cushions & poufs</li>
                        <li>ğŸª‘ Wooden folding chairs in circle</li>
                        <li>ğŸ“š Books displayed flat on long tables</li>
                        <li>ğŸ›ï¸ Ochre tufted floor mattress</li>
                    </ul>
                </div>
                <div class="moodboard-section">
                    <h3>ğŸ’¡ Lighting & Decor</h3>
                    <ul class="design-list" style="font-size: 12px;">
                        <li>ğŸª” Ethiopian hanging lamps with beaded fringe</li>
                        <li>ğŸª© Disco ball clusters at varying heights</li>
                        <li>ğŸ’« String lights with colored bulbs</li>
                        <li>ğŸº African pottery & woven baskets</li>
                        <li>ğŸª´ Hanging plants in macramÃ© holders</li>
                        <li>ğŸ–¼ï¸ Poster-covered walls (solidarity, art)</li>
                        <li>ğŸ§£ Tie-dye tablecloths on display tables</li>
                    </ul>
                </div>
                <div class="moodboard-section">
                    <h3>ğŸ­ Design Elements</h3>
                    <ul class="design-list" style="font-size: 12px;">
                        <li>ğŸªŸ Tall industrial windows with white frames</li>
                        <li>ğŸ›ï¸ White fluted columns between windows</li>
                        <li>ğŸ“° African diaspora magazines (Afrikadaa)</li>
                        <li>âœŠ Pan-African solidarity posters</li>
                        <li>ğŸ¨ Bold color mixing (no fear of clash)</li>
                        <li>ğŸŒ Global South aesthetic fusion</li>
                    </ul>
                </div>
                <div class="moodboard-section">
                    <h3>ğŸ“ Room Layout</h3>
                    <div class="layout-info" style="font-size: 12px;">
                        <p><strong>S202 - Special Special:</strong> Entry vestibule, display table with tie-dye cloth, listening corner with bean bags</p>
                        <p><strong>S203 - Reading Room:</strong> Poster-covered walls, nattes on floor, floor cushion seating, book displays</p>
                        <p><strong>Inspiration:</strong> Library of Muyinga (Burundi), Senegalese nattes, Wax prints</p>
                    </div>
                </div>
                <div class="moodboard-section">
                    <h3>ğŸ“¸ Reference Images</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px;">
                        <img src="photos refs reading room/Style mobilier/569a10d902522e95d504c7964c67310e.jpg" style="width: 100%; height: 60px; object-fit: cover; border-radius: 4px;" title="Ochre floor mattress with cushions">
                        <img src="photos refs reading room/ambiance/352102ea74fd486ae6c0906204724e6d.jpg" style="width: 100%; height: 60px; object-fit: cover; border-radius: 4px;" title="Layered rugs, disco balls, wooden chairs">
                        <img src="photos refs reading room/Style mobilier/-natte-plastique-thies.jpg" style="width: 100%; height: 60px; object-fit: cover; border-radius: 4px;" title="Senegalese plastic woven mats (nattes)">
                        <img src="photos refs reading room/inspiration afrique/The-Library-of-Muyinga-by-BC-architects_dezeen_8.jpg" style="width: 100%; height: 60px; object-fit: cover; border-radius: 4px;" title="Library of Muyinga - wooden platforms">
                        <img src="photos refs reading room/ambiance/_M5C0020.jpg" style="width: 100%; height: 60px; object-fit: cover; border-radius: 4px;" title="Colorful bean bags and poufs">
                        <img src="photos refs reading room/Style mobilier/tissu-wax.webp" style="width: 100%; height: 60px; object-fit: cover; border-radius: 4px;" title="African wax print fabric">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button id="decorator-btn" onclick="toggleDecorator()">ğŸ›‹ï¸ Decorator</button>
    <button id="render-btn" onclick="openRenderModal()">âœ¨ AI Render</button>
    <button id="admin-btn" onclick="toggleAdminLogin()">ğŸ” Admin</button>

    <!-- Login Modal -->
    <div id="login-modal">
        <div class="login-box">
            <h2>ğŸ” Admin Login</h2>
            <p>Enter your authorized email to access admin features</p>
            <input type="email" id="login-email" class="login-input" placeholder="your@email.com" onkeypress="if(event.key==='Enter')attemptLogin()">
            <button class="login-submit" onclick="attemptLogin()">Login</button>
            <button class="login-submit login-cancel" onclick="closeLoginModal()">Cancel</button>
            <div id="login-error" class="login-error"></div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel">
        <div class="admin-header">
            <div>
                <h2>ğŸ› ï¸ Admin Panel</h2>
                <div class="admin-user" id="admin-user-name">Logged in as: Admin</div>
            </div>
            <button class="admin-close" onclick="toggleAdminPanel()">âœ•</button>
        </div>

        <div class="admin-tabs">
            <button class="admin-tab active" onclick="switchAdminTab('layouts')">Layouts</button>
            <button class="admin-tab" onclick="switchAdminTab('views')">Views</button>
            <button class="admin-tab" onclick="switchAdminTab('moodboard')">Mood Board</button>
            <button class="admin-tab" onclick="switchAdminTab('renders')">AI Renders</button>
        </div>

        <div class="admin-content" id="admin-tab-layouts">
            <div class="admin-section">
                <h3>Save Current Layout</h3>
                <div class="admin-input-group">
                    <label>Configuration Name</label>
                    <input type="text" class="admin-input" id="layout-name" placeholder="e.g., Opening Night Setup">
                </div>
                <button class="admin-btn admin-btn-primary" onclick="saveAdminLayout()">ğŸ’¾ Save Layout</button>
                <button class="admin-btn admin-btn-secondary" onclick="exportLayoutFile()">ğŸ“¤ Export JSON</button>
            </div>

            <div class="admin-section">
                <h3>Saved Layouts</h3>
                <div class="saved-config-list" id="saved-layouts-list">
                    <div style="color: #666; font-size: 12px; padding: 10px;">Loading...</div>
                </div>
            </div>
        </div>

        <div class="admin-content" id="admin-tab-views" style="display:none;">
            <div class="admin-section">
                <h3>Save Current View</h3>
                <div class="admin-input-group">
                    <label>View Name</label>
                    <input type="text" class="admin-input" id="view-name" placeholder="e.g., Window Corner">
                </div>
                <div class="admin-input-group">
                    <label>Description</label>
                    <input type="text" class="admin-input" id="view-description" placeholder="Brief description">
                </div>
                <button class="admin-btn admin-btn-primary" onclick="saveAdminView()">ğŸ“ Save Current View</button>
            </div>

            <div class="admin-section">
                <h3>Saved Views</h3>
                <div class="saved-config-list" id="saved-views-list">
                    <div style="color: #666; font-size: 12px; padding: 10px;">Loading...</div>
                </div>
            </div>

            <div class="admin-section">
                <h3>Current Camera Position</h3>
                <div id="camera-position-display" style="font-family: monospace; font-size: 11px; color: #888; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                    Position: (0, 0, 0)<br>
                    Target: (0, 0, 0)
                </div>
            </div>
        </div>

        <div class="admin-content" id="admin-tab-moodboard" style="display:none;">
            <div class="admin-section">
                <h3>Add Mood Board Entry</h3>
                <div class="admin-input-group">
                    <label>Title</label>
                    <input type="text" class="admin-input" id="mood-title" placeholder="e.g., Color Inspiration">
                </div>
                <div class="admin-input-group">
                    <label>Image URL</label>
                    <input type="text" class="admin-input" id="mood-image-url" placeholder="https://...">
                </div>
                <div class="admin-input-group">
                    <label>Description</label>
                    <textarea class="admin-input admin-textarea" id="mood-description" placeholder="Describe this reference..."></textarea>
                </div>
                <div class="admin-input-group">
                    <label>Category</label>
                    <select class="admin-input" id="mood-category">
                        <option value="inspiration">Inspiration</option>
                        <option value="colors">Colors</option>
                        <option value="furniture">Furniture</option>
                        <option value="art">Artwork</option>
                        <option value="layout">Layout</option>
                    </select>
                </div>
                <button class="admin-btn admin-btn-primary" onclick="saveMoodEntry()">â• Add to Mood Board</button>
            </div>

            <div class="admin-section">
                <h3>Saved Mood Board Entries</h3>
                <div class="saved-config-list" id="saved-mood-list">
                    <div style="color: #666; font-size: 12px; padding: 10px;">Loading...</div>
                </div>
            </div>
        </div>

        <div class="admin-content" id="admin-tab-renders" style="display:none;">
            <div class="admin-section">
                <h3>AI Render History</h3>
                <p style="font-size: 11px; color: #888; margin-bottom: 15px;">Generated photorealistic renders of your room designs</p>
                <div class="saved-config-list" id="saved-renders-list">
                    <div style="color: #666; font-size: 12px; padding: 10px;">No renders yet. Click "AI Render" to generate one.</div>
                </div>
            </div>

            <div class="admin-section">
                <h3>Render Settings</h3>
                <div class="admin-input-group">
                    <label>Default Style</label>
                    <select class="admin-input" id="default-render-style">
                        <option value="photorealistic">Photorealistic</option>
                        <option value="warm-cozy">Warm & Cozy</option>
                        <option value="editorial">Editorial Magazine</option>
                        <option value="sketch">Architectural Sketch</option>
                    </select>
                </div>
            </div>
        </div>

        <div style="padding: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
            <button class="admin-btn admin-btn-secondary" onclick="logoutAdmin()" style="width: 100%;">ğŸšª Logout</button>
        </div>
    </div>

    <!-- Render Modal -->
    <div id="render-modal">
        <div class="render-box">
            <h2>âœ¨ AI Photorealistic Render</h2>
            <p>Transform your 3D scene into a stunning photorealistic image using Nano Banana AI</p>

            <div class="render-preview">
                <div class="render-preview-box">
                    <h4>Current 3D View</h4>
                    <div class="render-preview-img" id="render-input-preview">
                        Capture will appear here
                    </div>
                </div>
                <div class="render-preview-box">
                    <h4>AI Generated Render</h4>
                    <div class="render-preview-img" id="render-output-preview">
                        Generated image will appear here
                    </div>
                </div>
            </div>

            <div class="render-options">
                <div>
                    <label style="font-size: 11px; color: #888; display: block; margin-bottom: 8px;">Render Style</label>
                    <div class="render-style-grid">
                        <button class="render-style-btn active" onclick="selectRenderStyle('photorealistic', this)">ğŸ“¸ Photo</button>
                        <button class="render-style-btn" onclick="selectRenderStyle('warm-cozy', this)">ğŸŒ… Warm</button>
                        <button class="render-style-btn" onclick="selectRenderStyle('editorial', this)">ğŸ“° Editorial</button>
                        <button class="render-style-btn" onclick="selectRenderStyle('sketch', this)">âœï¸ Sketch</button>
                    </div>
                </div>
                <div>
                    <label style="font-size: 11px; color: #888; display: block; margin-bottom: 8px;">Custom Prompt (optional)</label>
                    <input type="text" class="admin-input" id="render-custom-prompt" placeholder="Add specific instructions...">
                </div>
            </div>

            <div id="render-status" class="render-status" style="display: none;">
                <span class="render-spinner"></span>
                <span id="render-status-text">Generating render...</span>
            </div>

            <div class="render-actions">
                <button class="render-btn-generate" id="generate-render-btn" onclick="generateRender()">
                    ğŸ¨ Generate Photorealistic Render
                </button>
                <button class="render-btn-close" onclick="closeRenderModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Decorator Panel -->
    <div id="decorator-panel">
        <div class="decorator-header">
            <h2>ğŸ›‹ï¸ Room Decorator</h2>
            <button class="decorator-close" onclick="toggleDecorator()">âœ•</button>
        </div>

        <div class="decorator-instructions">
            <strong>How to use:</strong> Select an item below, then click in the room to place it. Click placed items to select them for editing.
        </div>

        <div id="selected-item-info">
            <h4>Selected: <span id="selected-name">None</span></h4>
            <div class="item-controls">
                <button class="item-control-btn" onclick="moveItem(-0.2, 0)">â† Move</button>
                <button class="item-control-btn" onclick="moveItem(0.2, 0)">Move â†’</button>
                <button class="item-control-btn" onclick="moveItem(0, -0.2)">â†‘ Move</button>
                <button class="item-control-btn" onclick="moveItem(0, 0.2)">Move â†“</button>
                <button class="item-control-btn" onclick="rotateItem(15)">â†» Rotate</button>
                <button class="item-control-btn" onclick="rotateItem(-15)">â†º Rotate</button>
                <button class="item-control-btn danger" onclick="deleteItem()">ğŸ—‘ï¸ Delete</button>
            </div>
        </div>

        <div class="decorator-category" id="cat-seating">
            <h3 onclick="toggleCategory('cat-seating')">Seating - Bean Bags & Cushions</h3>
            <div class="item-grid">
                <div class="item-card" onclick="selectFurniture('beanbag-cream')">
                    <div class="item-preview" style="background: linear-gradient(145deg, #f5f0e8 0%, #d4c8b8 100%); border-radius: 20% 60% 40% 70%;">ğŸ¤</div>
                    <div class="item-name">Cream Bean Bag</div>
                </div>
                <div class="item-card" onclick="selectFurniture('beanbag-orange')">
                    <div class="item-preview" style="background: linear-gradient(145deg, #fd7e14 0%, #c96000 100%); border-radius: 20% 60% 40% 70%;">ğŸ§¡</div>
                    <div class="item-name">Orange Bean Bag</div>
                </div>
                <div class="item-card" onclick="selectFurniture('beanbag-magenta')">
                    <div class="item-preview" style="background: linear-gradient(145deg, #c2185b 0%, #880e4f 100%); border-radius: 20% 60% 40% 70%;">ğŸ’—</div>
                    <div class="item-name">Magenta Bean Bag</div>
                </div>
                <div class="item-card" onclick="selectFurniture('beanbag-teal')">
                    <div class="item-preview" style="background: linear-gradient(145deg, #26a69a 0%, #00796b 100%); border-radius: 20% 60% 40% 70%;">ğŸ’š</div>
                    <div class="item-name">Teal Bean Bag</div>
                </div>
                <div class="item-card" onclick="selectFurniture('cushion-ethnic-orange')">
                    <div class="item-preview" style="background: repeating-linear-gradient(45deg, #fd7e14, #fd7e14 5px, #c96000 5px, #c96000 10px); border-radius: 50%;">ğŸŸ </div>
                    <div class="item-name">Ethnic Orange</div>
                </div>
                <div class="item-card" onclick="selectFurniture('cushion-ethnic-burgundy')">
                    <div class="item-preview" style="background: repeating-linear-gradient(45deg, #8b2942, #8b2942 5px, #5a1a2a 5px, #5a1a2a 10px); border-radius: 50%;">ğŸŸ¤</div>
                    <div class="item-name">Ethnic Burgundy</div>
                </div>
                <div class="item-card" onclick="selectFurniture('cushion-velvet-teal')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #00897b 0%, #004d40 100%); border-radius: 50%;">ğŸ©µ</div>
                    <div class="item-name">Velvet Teal</div>
                </div>
                <div class="item-card" onclick="selectFurniture('cushion-round-green')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #7cb342 0%, #558b2f 100%); border-radius: 50%;">ğŸŸ¢</div>
                    <div class="item-name">Round Green</div>
                </div>
                <div class="item-card" onclick="selectFurniture('cushion-pebble-gray')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #90a4ae 0%, #607d8b 100%); border-radius: 40%;">âšª</div>
                    <div class="item-name">Pebble Gray</div>
                </div>
                <div class="item-card" onclick="selectFurniture('mattress-ochre')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #c9a227 0%, #a88520 100%); border-radius: 8px;">ğŸŸ¨</div>
                    <div class="item-name">Tufted Mattress</div>
                </div>
                <div class="item-card" onclick="selectFurniture('sofa-olive')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #827717 0%, #5d4037 100%); border-radius: 4px;">ğŸ›‹ï¸</div>
                    <div class="item-name">Olive Velvet Sofa</div>
                </div>
                <div class="item-card" onclick="selectFurniture('armchair-pink')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #e91e63 0%, #ad1457 100%); border-radius: 8px 8px 4px 4px;">ğŸª‘</div>
                    <div class="item-name">Pink Armchair</div>
                </div>
            </div>
        </div>

        <div class="decorator-category" id="cat-tables">
            <h3 onclick="toggleCategory('cat-tables')">Tables</h3>
            <div class="item-grid">
                <div class="item-card" onclick="selectFurniture('table-display')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #d4a76a 0%, #c4956a 100%); border-radius: 4px;">ğŸªµ</div>
                    <div class="item-name">Display Table</div>
                </div>
                <div class="item-card" onclick="selectFurniture('table-coffee')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #c4a77d 0%, #b09567 100%); border-radius: 50%;">â˜•</div>
                    <div class="item-name">Coffee Table</div>
                </div>
                <div class="item-card" onclick="selectFurniture('table-side')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #ffd93d 0%, #e0c030 100%); border-radius: 50%;">ğŸŸ¡</div>
                    <div class="item-name">Side Table</div>
                </div>
                <div class="item-card" onclick="selectFurniture('bench-wood')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #d4a76a 0%, #b8906a 100%); border-radius: 2px;">ğŸª‘</div>
                    <div class="item-name">Wood Bench</div>
                </div>
            </div>
        </div>

        <div class="decorator-category" id="cat-storage">
            <h3 onclick="toggleCategory('cat-storage')">Book Displays & Storage</h3>
            <div class="item-grid">
                <div class="item-card" onclick="selectFurniture('bookcase-wall')">
                    <div class="item-preview" style="background: linear-gradient(180deg, #efebe9 0%, #d7ccc8 100%);">ğŸ“š</div>
                    <div class="item-name">Wall Bookcase</div>
                </div>
                <div class="item-card" onclick="selectFurniture('book-cubby')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #d4a76a 0%, #a1887f 100%);">ğŸ“¦</div>
                    <div class="item-name">Book Cubby</div>
                </div>
                <div class="item-card" onclick="selectFurniture('magazine-rack')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #ffcc80 0%, #ffb74d 100%);">ğŸ“°</div>
                    <div class="item-name">Magazine Rack</div>
                </div>
                <div class="item-card" onclick="selectFurniture('book-stack')">
                    <div class="item-preview" style="background: linear-gradient(180deg, #e57373 0%, #1976d2 33%, #4caf50 66%, #ffc107 100%);">ğŸ“š</div>
                    <div class="item-name">Book Stack</div>
                </div>
                <div class="item-card" onclick="selectFurniture('display-pink')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #f8bbd0 0%, #f48fb1 100%);">ğŸ“•</div>
                    <div class="item-name">Pink Display</div>
                </div>
                <div class="item-card" onclick="selectFurniture('shelf-leaning')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #8d6e63 0%, #5d4037 100%);">ğŸ“–</div>
                    <div class="item-name">Leaning Shelf</div>
                </div>
            </div>
        </div>

        <div class="decorator-category" id="cat-rugs">
            <h3 onclick="toggleCategory('cat-rugs')">Rugs & Textiles - Layered</h3>
            <div class="item-grid">
                <div class="item-card" onclick="selectFurniture('rug-persian-red')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #b71c1c 0%, #7f0000 100%); border-radius: 2px;">ğŸŸ¥</div>
                    <div class="item-name">Persian Red</div>
                </div>
                <div class="item-card" onclick="selectFurniture('rug-persian-cream')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #efebe9 0%, #bcaaa4 100%); border-radius: 2px;">â¬œ</div>
                    <div class="item-name">Persian Cream</div>
                </div>
                <div class="item-card" onclick="selectFurniture('rug-natte-african')">
                    <div class="item-preview" style="background: repeating-conic-gradient(#ff1493 0% 25%, #00ced1 0% 50%) 50% / 8px 8px; border-radius: 2px;">ğŸ‡¸ğŸ‡³</div>
                    <div class="item-name">Natte Plastique</div>
                </div>
                <div class="item-card" onclick="selectFurniture('rug-checkered-pink')">
                    <div class="item-preview" style="background: repeating-conic-gradient(#e91e63 0% 25%, #f8bbd0 0% 50%) 50% / 10px 10px;">ğŸ©·</div>
                    <div class="item-name">Checkered Pink</div>
                </div>
                <div class="item-card" onclick="selectFurniture('rug-checkered-teal')">
                    <div class="item-preview" style="background: repeating-conic-gradient(#00897b 0% 25%, #b2dfdb 0% 50%) 50% / 10px 10px;">ğŸ©µ</div>
                    <div class="item-name">Checkered Teal</div>
                </div>
                <div class="item-card" onclick="selectFurniture('rug-wax-yellow')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #fdd835 0%, #f9a825 50%, #c41e3a 100%); border-radius: 2px;">ğŸŸ¡</div>
                    <div class="item-name">Wax Print Yellow</div>
                </div>
                <div class="item-card" onclick="selectFurniture('rug-geometric-bw')">
                    <div class="item-preview" style="background: repeating-linear-gradient(45deg, #000 0px, #000 5px, #fff 5px, #fff 10px); border-radius: 2px;">â¬›</div>
                    <div class="item-name">Geometric B&W</div>
                </div>
                <div class="item-card" onclick="selectFurniture('tablecloth-tiedye')">
                    <div class="item-preview" style="background: radial-gradient(circle, #c41e3a 0%, #1a3a5c 50%, #2d5a5a 100%); border-radius: 2px;">ğŸ¨</div>
                    <div class="item-name">Tie-Dye Cloth</div>
                </div>
            </div>
        </div>

        <div class="decorator-category" id="cat-lighting">
            <h3 onclick="toggleCategory('cat-lighting')">Lighting & Hanging</h3>
            <div class="item-grid">
                <div class="item-card" onclick="selectFurniture('lamp-ethiopian')">
                    <div class="item-preview" style="background: linear-gradient(180deg, #e65100 0%, #ff8f00 30%, #ffcc80 100%); border-radius: 50% 50% 20% 20%;">ğŸº</div>
                    <div class="item-name">Ethiopian Lamp</div>
                </div>
                <div class="item-card" onclick="selectFurniture('lamp-beaded')">
                    <div class="item-preview" style="background: linear-gradient(180deg, #d4a76a 0%, #bcaaa4 50%); border-radius: 30%;">âœ¨</div>
                    <div class="item-name">Beaded Lamp</div>
                </div>
                <div class="item-card" onclick="selectFurniture('disco-ball')">
                    <div class="item-preview" style="background: radial-gradient(circle, #fff 0%, #c0c0c0 50%, #808080 100%); border-radius: 50%;">ğŸª©</div>
                    <div class="item-name">Disco Ball</div>
                </div>
                <div class="item-card" onclick="selectFurniture('disco-ball-cluster')">
                    <div class="item-preview" style="background: radial-gradient(circle at 30% 30%, #fff 0%, #c0c0c0 20%, transparent 40%), radial-gradient(circle at 70% 60%, #fff 0%, #c0c0c0 15%, transparent 30%); background-color: #333;">ğŸª©ğŸª©</div>
                    <div class="item-name">Disco Cluster</div>
                </div>
                <div class="item-card" onclick="selectFurniture('light-string')">
                    <div class="item-preview" style="background: linear-gradient(90deg, #fff700 0%, transparent 20%, #fff700 25%, transparent 45%, #fff700 50%, transparent 70%, #fff700 75%, transparent 100%); background-color: #333;">ğŸ’¡</div>
                    <div class="item-name">String Lights</div>
                </div>
                <div class="item-card" onclick="selectFurniture('lantern-paper')">
                    <div class="item-preview" style="background: radial-gradient(circle, #fff8e1 0%, #ffcc80 100%); border-radius: 50%;">ğŸ®</div>
                    <div class="item-name">Paper Lantern</div>
                </div>
            </div>
        </div>

        <div class="decorator-category" id="cat-plants">
            <h3 onclick="toggleCategory('cat-plants')">Plants & African Decor</h3>
            <div class="item-grid">
                <div class="item-card" onclick="selectFurniture('plant-palm')">
                    <div class="item-preview" style="background: linear-gradient(180deg, #2e7d32 0%, #1b5e20 50%, #6d4c41 80%);">ğŸŒ´</div>
                    <div class="item-name">Palm Plant</div>
                </div>
                <div class="item-card" onclick="selectFurniture('plant-hanging')">
                    <div class="item-preview" style="background: linear-gradient(180deg, #388e3c 0%, #66bb6a 100%);">ğŸŒ¿</div>
                    <div class="item-name">Hanging Plant</div>
                </div>
                <div class="item-card" onclick="selectFurniture('plant-pothos')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #4caf50 0%, #81c784 100%);">ğŸƒ</div>
                    <div class="item-name">Pothos Vine</div>
                </div>
                <div class="item-card" onclick="selectFurniture('basket-woven')">
                    <div class="item-preview" style="background: repeating-linear-gradient(45deg, #d4a76a 0px, #d4a76a 3px, #8d6e63 3px, #8d6e63 6px);">ğŸ§º</div>
                    <div class="item-name">Woven Basket</div>
                </div>
                <div class="item-card" onclick="selectFurniture('pottery-african')">
                    <div class="item-preview" style="background: linear-gradient(180deg, #5d4037 0%, #3e2723 100%); border-radius: 40% 40% 50% 50%;">ğŸº</div>
                    <div class="item-name">African Pottery</div>
                </div>
                <div class="item-card" onclick="selectFurniture('sculpture-wood')">
                    <div class="item-preview" style="background: linear-gradient(180deg, #4e342e 0%, #3e2723 100%);">ğŸ—¿</div>
                    <div class="item-name">Wood Sculpture</div>
                </div>
            </div>
        </div>

        <div class="decorator-category" id="cat-wallart">
            <h3 onclick="toggleCategory('cat-wallart')">Wall Art - Afrikadaa</h3>
            <div class="item-grid">
                <div class="item-card art-item-card" onclick="selectFurniture('poster-afrikadaa-1')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #ff6b6b 0%, #ffd93d 50%, #4ecdc4 100%);">ğŸ–¼ï¸</div>
                    <div class="item-name">Afrikadaa Cover #1</div>
                </div>
                <div class="item-card art-item-card" onclick="selectFurniture('poster-afrikadaa-2')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #45b7d1 0%, #96ceb4 100%);">ğŸ–¼ï¸</div>
                    <div class="item-name">Afrikadaa Cover #2</div>
                </div>
                <div class="item-card art-item-card" onclick="selectFurniture('poster-afrikadaa-3')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #e17055 0%, #fdcb6e 100%);">ğŸ–¼ï¸</div>
                    <div class="item-name">African Contemporary</div>
                </div>
            </div>
        </div>

        <div class="decorator-category" id="cat-wallart2">
            <h3 onclick="toggleCategory('cat-wallart2')">Wall Art - Coolhunt Paris</h3>
            <div class="item-grid">
                <div class="item-card art-item-card" onclick="selectFurniture('poster-coolhunt-1')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #1a1a1a 0%, #4a4a4a 100%);">ğŸ“·</div>
                    <div class="item-name">Fashion Photo</div>
                </div>
                <div class="item-card art-item-card" onclick="selectFurniture('poster-coolhunt-2')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #ff6b6b 0%, #c41e3a 100%);">ğŸ¨</div>
                    <div class="item-name">Street Art Print</div>
                </div>
                <div class="item-card art-item-card" onclick="selectFurniture('poster-coolhunt-3')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);">ğŸ–Œï¸</div>
                    <div class="item-name">Design Print</div>
                </div>
            </div>
        </div>

        <div class="decorator-category" id="cat-activist">
            <h3 onclick="toggleCategory('cat-activist')">Wall Art - Activist</h3>
            <div class="item-grid">
                <div class="item-card art-item-card" onclick="selectFurniture('poster-activist-1')">
                    <div class="item-preview" style="background: #1a3a5c; color: #fff; font-size: 10px; padding: 5px;">WE WANT TO LIVE FREE</div>
                    <div class="item-name">Live Free Banner</div>
                </div>
                <div class="item-card art-item-card" onclick="selectFurniture('poster-activist-2')">
                    <div class="item-preview" style="background: #f5f0e8; color: #1a1a1a; font-size: 10px; padding: 5px;">SOMOS PERSONAS</div>
                    <div class="item-name">Somos Personas</div>
                </div>
                <div class="item-card art-item-card" onclick="selectFurniture('poster-activist-3')">
                    <div class="item-preview" style="background: linear-gradient(135deg, #c41e3a 0%, #1a1a1a 100%); font-size: 10px;">âœŠ</div>
                    <div class="item-name">Resistance Art</div>
                </div>
            </div>
        </div>

        <div class="decorator-actions">
            <button class="decorator-action-btn primary" onclick="saveLayout()">ğŸ’¾ Save Layout</button>
            <button class="decorator-action-btn secondary" onclick="loadLayout()">ğŸ“‚ Load Layout</button>
            <button class="decorator-action-btn secondary" onclick="resetLayout()">ğŸ”„ Reset</button>
            <button class="decorator-action-btn secondary" onclick="exportLayout()">ğŸ“¤ Export JSON</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a1a);

        const container = document.getElementById('canvas-container');
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);

        const renderer = new THREE.WebGLRenderer({ antialias: true, preserveDrawingBuffer: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        // ============================================================
        // EXACT DIMENSIONS FROM FLOOR PLAN (converted to meters)
        // CORRECTED LAYOUT: Windows on FRONT (south), Doors on BACK (north)
        // Room S202 "Special Special" is LEFT, Room S203 "Reading Room" is RIGHT
        // Room S202 has an entry vestibule/corridor before main space
        // ============================================================
        const ROOM_S202_WIDTH = 3.496;  // 11'-5â…" (X direction)
        const ROOM_S202_DEPTH = 7.715;  // 25'-3Â¾" (Z direction)
        const ROOM_S203_WIDTH = 4.465;  // 14'-7Â¾"
        const ROOM_S203_DEPTH = 7.715;  // 25'-3Â¾"
        const CEILING_HEIGHT = 3.66;   // 12' ceiling
        const WALL_THICKNESS = 0.152;  // 6"
        const DOOR_WIDTH = 1.044;      // 3'-5â…›"
        const DOOR_HEIGHT = 2.134;     // 7'-0"

        // Entry vestibule dimensions for Room S202 (estimated from plan)
        const VESTIBULE_WIDTH = ROOM_S202_WIDTH;  // Same width as room
        const VESTIBULE_DEPTH = 1.5;  // ~5' deep vestibule/corridor

        // Window dimensions (from reference photos - MoMA PS1 industrial windows)
        // Tall rectangular windows with white frames, grid pattern
        const PS1_WINDOW_WIDTH = 1.3;      // ~4.25 feet
        const PS1_WINDOW_HEIGHT = 2.2;     // ~7.25 feet tall
        const PS1_WINDOW_SILL = 0.75;      // ~2.5 feet sill height
        const PS1_COLUMN_WIDTH = 0.25;     // White fluted columns between windows

        // Materials
        const wallMaterial = new THREE.MeshLambertMaterial({ color: 0xf8f8f5, side: THREE.DoubleSide });
        const brickMaterial = new THREE.MeshLambertMaterial({ color: 0xf0ebe5, side: THREE.DoubleSide });
        const floorMaterial = new THREE.MeshLambertMaterial({ color: 0xd4c8b8 });
        const darkBlueMaterial = new THREE.MeshLambertMaterial({ color: 0x2c3e5c });
        const windowFrameMaterial = new THREE.MeshLambertMaterial({ color: 0xe8e8e8 });
        const glassMaterial = new THREE.MeshLambertMaterial({ color: 0x87CEEB, transparent: true, opacity: 0.25 });
        const woodMaterial = new THREE.MeshLambertMaterial({ color: 0xd4a76a });
        const ochreFloorMaterial = new THREE.MeshLambertMaterial({ color: 0xc9a227 });
        const redMaterial = new THREE.MeshLambertMaterial({ color: 0xc41e3a });

        // Groups for visibility control
        const labelsGroup = new THREE.Group();
        const ceilingsGroup = new THREE.Group();
        const wallsGroup = new THREE.Group();
        const roomS202Walls = { front: null, back: null, left: null, right: null, vestibuleLeft: null, vestibuleRight: null };
        const roomS203Walls = { front: null, back: null, left: null, right: null };

        const gridHelper = new THREE.GridHelper(20, 40, 0x444444, 0x333333);
        scene.add(gridHelper);

        // Position rooms side by side (Room S202 LEFT, Room S203 RIGHT)
        const TOTAL_WIDTH = ROOM_S202_WIDTH + WALL_THICKNESS + ROOM_S203_WIDTH;
        const ROOM_S202_X = -TOTAL_WIDTH / 2 + ROOM_S202_WIDTH / 2;
        const ROOM_S203_X = TOTAL_WIDTH / 2 - ROOM_S203_WIDTH / 2;

        // ============ HELPER FUNCTIONS ============

        function createArchedWindow(width, height, archRadius, hasFabricFrame = true) {
            const group = new THREE.Group();
            const frameThickness = 0.08;

            // Glass
            const glassShape = new THREE.Shape();
            glassShape.moveTo(-width/2, 0);
            glassShape.lineTo(-width/2, height - archRadius);
            glassShape.quadraticCurveTo(-width/2, height, 0, height);
            glassShape.quadraticCurveTo(width/2, height, width/2, height - archRadius);
            glassShape.lineTo(width/2, 0);
            glassShape.lineTo(-width/2, 0);

            const glass = new THREE.Mesh(new THREE.ShapeGeometry(glassShape), glassMaterial);
            group.add(glass);

            // Frame bars
            const leftFrame = new THREE.Mesh(new THREE.BoxGeometry(frameThickness, height - archRadius, frameThickness), windowFrameMaterial);
            leftFrame.position.set(-width/2, (height - archRadius)/2, 0);
            group.add(leftFrame);

            const rightFrame = new THREE.Mesh(new THREE.BoxGeometry(frameThickness, height - archRadius, frameThickness), windowFrameMaterial);
            rightFrame.position.set(width/2, (height - archRadius)/2, 0);
            group.add(rightFrame);

            const bottomFrame = new THREE.Mesh(new THREE.BoxGeometry(width + frameThickness, frameThickness, frameThickness), windowFrameMaterial);
            bottomFrame.position.set(0, 0, 0);
            group.add(bottomFrame);

            const centerFrame = new THREE.Mesh(new THREE.BoxGeometry(frameThickness, height - archRadius, frameThickness), windowFrameMaterial);
            centerFrame.position.set(0, (height - archRadius)/2, 0);
            group.add(centerFrame);

            const middleFrame = new THREE.Mesh(new THREE.BoxGeometry(width, frameThickness, frameThickness), windowFrameMaterial);
            middleFrame.position.set(0, height * 0.4, 0);
            group.add(middleFrame);

            // Dark blue fabric frame
            if (hasFabricFrame) {
                const fabricWidth = width + 0.4;
                const fabricHeight = height + 0.3;
                const leftFabric = new THREE.Mesh(new THREE.BoxGeometry(0.15, fabricHeight, 0.02), darkBlueMaterial);
                leftFabric.position.set(-fabricWidth/2, fabricHeight/2, 0.02);
                group.add(leftFabric);
                const rightFabric = new THREE.Mesh(new THREE.BoxGeometry(0.15, fabricHeight, 0.02), darkBlueMaterial);
                rightFabric.position.set(fabricWidth/2, fabricHeight/2, 0.02);
                group.add(rightFabric);
                const topFabric = new THREE.Mesh(new THREE.BoxGeometry(fabricWidth, 0.15, 0.02), darkBlueMaterial);
                topFabric.position.set(0, fabricHeight - 0.1, 0.02);
                group.add(topFabric);
            }

            return group;
        }

        // MoMA PS1 style industrial window - tall rectangular with grid pattern
        function createPS1Window(width, height) {
            const group = new THREE.Group();

            // Glass pane
            const glass = new THREE.Mesh(
                new THREE.PlaneGeometry(width, height),
                glassMaterial
            );
            group.add(glass);

            // White window frame
            const frameThickness = 0.05;
            const frameMat = new THREE.MeshLambertMaterial({ color: 0xffffff });

            // Outer frame
            const topFrame = new THREE.Mesh(new THREE.BoxGeometry(width + 0.08, frameThickness, frameThickness), frameMat);
            topFrame.position.set(0, height/2, 0.02);
            group.add(topFrame);

            const bottomFrame = new THREE.Mesh(new THREE.BoxGeometry(width + 0.08, frameThickness, frameThickness), frameMat);
            bottomFrame.position.set(0, -height/2, 0.02);
            group.add(bottomFrame);

            const leftFrame = new THREE.Mesh(new THREE.BoxGeometry(frameThickness, height, frameThickness), frameMat);
            leftFrame.position.set(-width/2, 0, 0.02);
            group.add(leftFrame);

            const rightFrame = new THREE.Mesh(new THREE.BoxGeometry(frameThickness, height, frameThickness), frameMat);
            rightFrame.position.set(width/2, 0, 0.02);
            group.add(rightFrame);

            // Horizontal dividers (3 panes vertically = 2 dividers)
            const dividerH1 = new THREE.Mesh(new THREE.BoxGeometry(width, frameThickness * 0.7, frameThickness), frameMat);
            dividerH1.position.set(0, height * 0.2, 0.02);
            group.add(dividerH1);

            const dividerH2 = new THREE.Mesh(new THREE.BoxGeometry(width, frameThickness * 0.7, frameThickness), frameMat);
            dividerH2.position.set(0, -height * 0.2, 0.02);
            group.add(dividerH2);

            // Vertical center divider
            const centerV = new THREE.Mesh(new THREE.BoxGeometry(frameThickness * 0.7, height, frameThickness), frameMat);
            centerV.position.set(0, 0, 0.02);
            group.add(centerV);

            return group;
        }

        // Create white fluted column/pilaster (decorative element between windows)
        function createFlutedColumn(height) {
            const group = new THREE.Group();
            const columnMat = new THREE.MeshLambertMaterial({ color: 0xf5f5f0 });

            // Main column body
            const column = new THREE.Mesh(
                new THREE.BoxGeometry(PS1_COLUMN_WIDTH, height, 0.1),
                columnMat
            );
            column.position.set(0, height/2, 0);
            group.add(column);

            // Add fluting detail (vertical ridges)
            const fluteMat = new THREE.MeshLambertMaterial({ color: 0xe8e8e3 });
            for (let i = -2; i <= 2; i++) {
                const flute = new THREE.Mesh(
                    new THREE.BoxGeometry(0.02, height, 0.03),
                    fluteMat
                );
                flute.position.set(i * 0.05, height/2, 0.06);
                group.add(flute);
            }

            return group;
        }

        function createFloorCushion(color, size = 0.6) {
            const group = new THREE.Group();
            const cushion = new THREE.Mesh(new THREE.SphereGeometry(size / 2, 16, 12), new THREE.MeshLambertMaterial({ color }));
            cushion.scale.set(1, 0.5, 1);
            cushion.position.set(0, size * 0.25, 0);
            group.add(cushion);
            return group;
        }

        function createTuftedFloorMattress(width, depth) {
            const group = new THREE.Group();
            const mattress = new THREE.Mesh(new THREE.BoxGeometry(width, 0.2, depth), ochreFloorMaterial);
            mattress.position.set(0, 0.1, 0);
            group.add(mattress);
            const buttonMat = new THREE.MeshLambertMaterial({ color: 0xa88520 });
            for (let x = -width/2 + 0.3; x < width/2; x += 0.3) {
                for (let z = -depth/2 + 0.3; z < depth/2; z += 0.3) {
                    const button = new THREE.Mesh(new THREE.CylinderGeometry(0.02, 0.02, 0.05, 8), buttonMat);
                    button.position.set(x, 0.2, z);
                    group.add(button);
                }
            }
            return group;
        }

        function createLayeredRug(width, depth, color) {
            const group = new THREE.Group();
            const rug = new THREE.Mesh(new THREE.BoxGeometry(width, 0.02, depth), new THREE.MeshLambertMaterial({ color }));
            rug.position.set(0, 0.01, 0);
            group.add(rug);
            const borderMat = new THREE.MeshLambertMaterial({ color: 0x2d2d2d });
            const topBorder = new THREE.Mesh(new THREE.BoxGeometry(width, 0.025, 0.05), borderMat);
            topBorder.position.set(0, 0.02, -depth/2 + 0.025);
            group.add(topBorder);
            const bottomBorder = new THREE.Mesh(new THREE.BoxGeometry(width, 0.025, 0.05), borderMat);
            bottomBorder.position.set(0, 0.02, depth/2 - 0.025);
            group.add(bottomBorder);
            return group;
        }

        function createWoodenBookshelf(width, height, rows) {
            const group = new THREE.Group();
            const shelfWood = new THREE.MeshLambertMaterial({ color: 0xe8d4b8 });
            const backPanel = new THREE.Mesh(new THREE.BoxGeometry(width, height, 0.02), shelfWood);
            backPanel.position.set(0, height/2, 0);
            group.add(backPanel);

            const shelfSpacing = height / (rows + 1);
            for (let i = 1; i <= rows; i++) {
                const shelf = new THREE.Mesh(new THREE.BoxGeometry(width, 0.02, 0.15), shelfWood);
                shelf.position.set(0, i * shelfSpacing, 0.08);
                group.add(shelf);
                const bookCount = Math.floor(width / 0.2);
                const bookColors = [0x4ecdc4, 0xff6b6b, 0xffd93d, 0x45b7d1, 0x96ceb4, 0xa29bfe, 0xe17055, 0x00b894];
                for (let j = 0; j < bookCount; j++) {
                    const book = new THREE.Mesh(new THREE.BoxGeometry(0.15, 0.2, 0.02), new THREE.MeshLambertMaterial({ color: bookColors[j % bookColors.length] }));
                    book.position.set(-width/2 + 0.1 + j * 0.18, i * shelfSpacing + 0.12, 0.14);
                    group.add(book);
                }
            }
            return group;
        }

        function createPottedPlant() {
            const group = new THREE.Group();
            const pot = new THREE.Mesh(new THREE.CylinderGeometry(0.12, 0.1, 0.2, 12), new THREE.MeshLambertMaterial({ color: 0xc4713d }));
            pot.position.set(0, 0.1, 0);
            group.add(pot);
            const soil = new THREE.Mesh(new THREE.CylinderGeometry(0.11, 0.11, 0.03, 12), new THREE.MeshLambertMaterial({ color: 0x4a3728 }));
            soil.position.set(0, 0.2, 0);
            group.add(soil);
            const leafMat = new THREE.MeshLambertMaterial({ color: 0x228b22 });
            for (let i = 0; i < 6; i++) {
                const leaf = new THREE.Mesh(new THREE.SphereGeometry(0.08 + Math.random() * 0.04, 8, 8), leafMat);
                leaf.position.set((Math.random() - 0.5) * 0.15, 0.35 + Math.random() * 0.15, (Math.random() - 0.5) * 0.15);
                leaf.scale.set(1, 0.6, 1);
                group.add(leaf);
            }
            return group;
        }

        function createPendantLight() {
            const group = new THREE.Group();
            const cord = new THREE.Mesh(new THREE.CylinderGeometry(0.01, 0.01, 0.8, 8), new THREE.MeshLambertMaterial({ color: 0x333333 }));
            cord.position.set(0, 0.4, 0);
            group.add(cord);
            const shade = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.25, 0.2, 16, 1, true), new THREE.MeshLambertMaterial({ color: 0xd4a76a, side: THREE.DoubleSide }));
            group.add(shade);
            const bulb = new THREE.Mesh(new THREE.SphereGeometry(0.05, 8, 8), new THREE.MeshBasicMaterial({ color: 0xfffacd }));
            group.add(bulb);
            return group;
        }

        function createLowCoffeeTable() {
            const group = new THREE.Group();
            const tableMat = new THREE.MeshLambertMaterial({ color: 0xc4a77d });
            const top = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.4, 0.04, 24), tableMat);
            top.position.set(0, 0.25, 0);
            group.add(top);
            for (let i = 0; i < 3; i++) {
                const angle = (i * 2 * Math.PI) / 3;
                const leg = new THREE.Mesh(new THREE.CylinderGeometry(0.03, 0.04, 0.23, 8), tableMat);
                leg.position.set(Math.cos(angle) * 0.25, 0.115, Math.sin(angle) * 0.25);
                group.add(leg);
            }
            return group;
        }

        function createRedBookDisplay() {
            const group = new THREE.Group();
            const bodyWidth = 0.7, bodyHeight = 0.9, bodyDepth = 0.5;
            const backPanel = new THREE.Mesh(new THREE.BoxGeometry(bodyWidth, bodyHeight, 0.03), redMaterial);
            backPanel.position.set(0, bodyHeight/2, -bodyDepth/2);
            group.add(backPanel);
            for (let i = 0; i < 4; i++) {
                const shelf = new THREE.Mesh(new THREE.BoxGeometry(bodyWidth - 0.05, 0.02, bodyDepth * 0.6), redMaterial);
                shelf.position.set(0, 0.15 + i * 0.2, -0.1);
                shelf.rotation.x = -0.2;
                group.add(shelf);
                const bookColors = [0xffffff, 0x4ecdc4, 0xff6b6b, 0xffd93d, 0x95e1d3];
                for (let j = 0; j < 5; j++) {
                    const book = new THREE.Mesh(new THREE.BoxGeometry(0.08, 0.15, 0.01), new THREE.MeshLambertMaterial({ color: bookColors[j] }));
                    book.position.set(-0.25 + j * 0.12, 0.25 + i * 0.2, 0);
                    book.rotation.x = -0.3;
                    group.add(book);
                }
            }
            const sideL = new THREE.Mesh(new THREE.BoxGeometry(0.03, bodyHeight, bodyDepth), redMaterial);
            sideL.position.set(-bodyWidth/2, bodyHeight/2, 0);
            group.add(sideL);
            const sideR = new THREE.Mesh(new THREE.BoxGeometry(0.03, bodyHeight, bodyDepth), redMaterial);
            sideR.position.set(bodyWidth/2, bodyHeight/2, 0);
            group.add(sideR);
            return group;
        }

        function createPosterWall(width, height) {
            const group = new THREE.Group();
            const baseWall = new THREE.Mesh(new THREE.PlaneGeometry(width, height), new THREE.MeshLambertMaterial({ color: 0xf5f0e8 }));
            group.add(baseWall);
            const posterColors = [0xff6b6b, 0xffd93d, 0x4ecdc4, 0x45b7d1, 0x96ceb4, 0xffeaa7, 0xdfe6e9, 0xfd79a8, 0x00b894, 0xe17055, 0x74b9ff, 0xa29bfe, 0x55efc4, 0xfdcb6e, 0xe84393];
            for (let i = 0; i < 60; i++) {
                const posterW = 0.15 + Math.random() * 0.3;
                const posterH = 0.2 + Math.random() * 0.35;
                const poster = new THREE.Mesh(new THREE.PlaneGeometry(posterW, posterH), new THREE.MeshLambertMaterial({ color: posterColors[Math.floor(Math.random() * posterColors.length)] }));
                poster.position.set((Math.random() - 0.5) * (width - posterW), (Math.random() - 0.5) * (height - posterH), 0.005 + i * 0.001);
                poster.rotation.z = (Math.random() - 0.5) * 0.1;
                group.add(poster);
            }
            return group;
        }

        // ============ ROOM S202 - SPECIAL SPECIAL ============
        // LAYOUT: Windows on FRONT (+Z), Door to corridor on BACK (-Z) via VESTIBULE, Door to S203 on RIGHT (+X)
        // Has an entry vestibule/corridor - a narrow enclosed passage before the main room
        function createRoomS202() {
            const group = new THREE.Group();

            // Vestibule corridor dimensions - enclosed passage with side walls
            const CORRIDOR_WIDTH = 1.2;  // Narrow corridor width (~4 feet)
            const CORRIDOR_OFFSET_X = 0;  // Corridor centered on door

            // ========== FLOOR (entire room) ==========
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(ROOM_S202_WIDTH, ROOM_S202_DEPTH), floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.set(0, 0.01, 0);
            group.add(floor);

            // Dark blue carpet in main area (not in vestibule)
            const carpet = new THREE.Mesh(new THREE.PlaneGeometry(ROOM_S202_WIDTH - 0.5, ROOM_S202_DEPTH - VESTIBULE_DEPTH - 0.5), new THREE.MeshLambertMaterial({ color: 0x1a3a5c }));
            carpet.rotation.x = -Math.PI / 2;
            carpet.position.set(0, 0.02, VESTIBULE_DEPTH / 2);
            group.add(carpet);

            // ========== BACK WALL (-Z) - Door to corridor/STUDIO ==========
            const backWallGroup = new THREE.Group();
            const backWall1 = new THREE.Mesh(new THREE.BoxGeometry((ROOM_S202_WIDTH - DOOR_WIDTH) / 2, CEILING_HEIGHT, WALL_THICKNESS), wallMaterial);
            backWall1.position.set(-ROOM_S202_WIDTH / 4 - DOOR_WIDTH / 4, CEILING_HEIGHT / 2, -ROOM_S202_DEPTH / 2);
            backWallGroup.add(backWall1);
            const backWall2 = new THREE.Mesh(new THREE.BoxGeometry((ROOM_S202_WIDTH - DOOR_WIDTH) / 2, CEILING_HEIGHT, WALL_THICKNESS), wallMaterial);
            backWall2.position.set(ROOM_S202_WIDTH / 4 + DOOR_WIDTH / 4, CEILING_HEIGHT / 2, -ROOM_S202_DEPTH / 2);
            backWallGroup.add(backWall2);
            const backDoorHeader = new THREE.Mesh(new THREE.BoxGeometry(DOOR_WIDTH, CEILING_HEIGHT - DOOR_HEIGHT, WALL_THICKNESS), wallMaterial);
            backDoorHeader.position.set(0, DOOR_HEIGHT + (CEILING_HEIGHT - DOOR_HEIGHT) / 2, -ROOM_S202_DEPTH / 2);
            backWallGroup.add(backDoorHeader);
            group.add(backWallGroup);
            roomS202Walls.back = backWallGroup;

            // ========== VESTIBULE CORRIDOR WALLS ==========
            // The vestibule is an enclosed corridor with:
            // - Two SIDE walls running from back wall (-Z) toward the room (+Z)
            // - One FRONT wall (partition) with a door opening to main room
            const vestibuleGroup = new THREE.Group();

            // LEFT side wall of vestibule (runs along Z axis)
            const vestibuleLeftSide = new THREE.Mesh(
                new THREE.BoxGeometry(WALL_THICKNESS, CEILING_HEIGHT, VESTIBULE_DEPTH),
                wallMaterial
            );
            vestibuleLeftSide.position.set(
                CORRIDOR_OFFSET_X - CORRIDOR_WIDTH / 2,
                CEILING_HEIGHT / 2,
                -ROOM_S202_DEPTH / 2 + VESTIBULE_DEPTH / 2
            );
            vestibuleGroup.add(vestibuleLeftSide);

            // RIGHT side wall of vestibule (runs along Z axis)
            const vestibuleRightSide = new THREE.Mesh(
                new THREE.BoxGeometry(WALL_THICKNESS, CEILING_HEIGHT, VESTIBULE_DEPTH),
                wallMaterial
            );
            vestibuleRightSide.position.set(
                CORRIDOR_OFFSET_X + CORRIDOR_WIDTH / 2,
                CEILING_HEIGHT / 2,
                -ROOM_S202_DEPTH / 2 + VESTIBULE_DEPTH / 2
            );
            vestibuleGroup.add(vestibuleRightSide);

            // FRONT partition wall of vestibule (with door opening to main room)
            // Left section of front partition
            const partitionLeftWidth = (ROOM_S202_WIDTH / 2) - (CORRIDOR_WIDTH / 2) - CORRIDOR_OFFSET_X;
            if (partitionLeftWidth > 0) {
                const partitionLeft = new THREE.Mesh(
                    new THREE.BoxGeometry(partitionLeftWidth, CEILING_HEIGHT, WALL_THICKNESS),
                    wallMaterial
                );
                partitionLeft.position.set(
                    -ROOM_S202_WIDTH / 2 + partitionLeftWidth / 2,
                    CEILING_HEIGHT / 2,
                    -ROOM_S202_DEPTH / 2 + VESTIBULE_DEPTH
                );
                vestibuleGroup.add(partitionLeft);
            }

            // Right section of front partition
            const partitionRightWidth = (ROOM_S202_WIDTH / 2) - (CORRIDOR_WIDTH / 2) + CORRIDOR_OFFSET_X;
            if (partitionRightWidth > 0) {
                const partitionRight = new THREE.Mesh(
                    new THREE.BoxGeometry(partitionRightWidth, CEILING_HEIGHT, WALL_THICKNESS),
                    wallMaterial
                );
                partitionRight.position.set(
                    ROOM_S202_WIDTH / 2 - partitionRightWidth / 2,
                    CEILING_HEIGHT / 2,
                    -ROOM_S202_DEPTH / 2 + VESTIBULE_DEPTH
                );
                vestibuleGroup.add(partitionRight);
            }

            // Header above vestibule door opening
            const vestibuleDoorHeader = new THREE.Mesh(
                new THREE.BoxGeometry(CORRIDOR_WIDTH, CEILING_HEIGHT - DOOR_HEIGHT, WALL_THICKNESS),
                wallMaterial
            );
            vestibuleDoorHeader.position.set(
                CORRIDOR_OFFSET_X,
                DOOR_HEIGHT + (CEILING_HEIGHT - DOOR_HEIGHT) / 2,
                -ROOM_S202_DEPTH / 2 + VESTIBULE_DEPTH
            );
            vestibuleGroup.add(vestibuleDoorHeader);

            group.add(vestibuleGroup);
            roomS202Walls.vestibuleLeft = vestibuleLeftSide;
            roomS202Walls.vestibuleRight = vestibuleRightSide;
            roomS202Walls.vestibuleGroup = vestibuleGroup;  // Store entire vestibule for hiding

            // ========== FRONT WALL (+Z) - PS1 Industrial Windows ==========
            const frontWallGroup = new THREE.Group();

            // Wall below windows (sill area)
            const frontWallBase = new THREE.Mesh(
                new THREE.BoxGeometry(ROOM_S202_WIDTH, PS1_WINDOW_SILL, WALL_THICKNESS),
                wallMaterial
            );
            frontWallBase.position.set(0, PS1_WINDOW_SILL / 2, ROOM_S202_DEPTH / 2);
            frontWallGroup.add(frontWallBase);

            // Wall above windows
            const topWallHeight = CEILING_HEIGHT - PS1_WINDOW_SILL - PS1_WINDOW_HEIGHT;
            const frontWallTop = new THREE.Mesh(
                new THREE.BoxGeometry(ROOM_S202_WIDTH, topWallHeight, WALL_THICKNESS),
                wallMaterial
            );
            frontWallTop.position.set(0, PS1_WINDOW_SILL + PS1_WINDOW_HEIGHT + topWallHeight / 2, ROOM_S202_DEPTH / 2);
            frontWallGroup.add(frontWallTop);

            // Two windows with fluted column between them
            const windowSpacing = (ROOM_S202_WIDTH - PS1_COLUMN_WIDTH) / 2;
            const windowCenterY = PS1_WINDOW_SILL + PS1_WINDOW_HEIGHT / 2;

            // Left window
            const win1 = createPS1Window(PS1_WINDOW_WIDTH, PS1_WINDOW_HEIGHT);
            win1.position.set(-windowSpacing / 2, windowCenterY, ROOM_S202_DEPTH / 2 - 0.02);
            frontWallGroup.add(win1);

            // Right window
            const win2 = createPS1Window(PS1_WINDOW_WIDTH, PS1_WINDOW_HEIGHT);
            win2.position.set(windowSpacing / 2, windowCenterY, ROOM_S202_DEPTH / 2 - 0.02);
            frontWallGroup.add(win2);

            // Fluted column between windows
            const columnS202 = createFlutedColumn(PS1_WINDOW_HEIGHT);
            columnS202.position.set(0, PS1_WINDOW_SILL, ROOM_S202_DEPTH / 2 - 0.02);
            frontWallGroup.add(columnS202);

            // Wall sections on either side of windows
            const sideWallWidth = (ROOM_S202_WIDTH - windowSpacing * 2 - PS1_WINDOW_WIDTH * 2) / 2 + 0.3;
            if (sideWallWidth > 0.1) {
                const leftSide = new THREE.Mesh(
                    new THREE.BoxGeometry(sideWallWidth, PS1_WINDOW_HEIGHT, WALL_THICKNESS),
                    wallMaterial
                );
                leftSide.position.set(-ROOM_S202_WIDTH / 2 + sideWallWidth / 2, windowCenterY, ROOM_S202_DEPTH / 2);
                frontWallGroup.add(leftSide);

                const rightSide = new THREE.Mesh(
                    new THREE.BoxGeometry(sideWallWidth, PS1_WINDOW_HEIGHT, WALL_THICKNESS),
                    wallMaterial
                );
                rightSide.position.set(ROOM_S202_WIDTH / 2 - sideWallWidth / 2, windowCenterY, ROOM_S202_DEPTH / 2);
                frontWallGroup.add(rightSide);
            }

            group.add(frontWallGroup);
            roomS202Walls.front = frontWallGroup;

            // ========== LEFT WALL (-X) - Wall with CLOSED DOOR to Three Star room ==========
            // From floor plan: Three Star door is near the SOUTH (window) end of the west wall
            // The west wall runs the full depth of the room from north to south
            const leftWallGroup = new THREE.Group();

            // Wall X position (west wall of room) - flush with room boundary
            const leftWallX = -ROOM_S202_WIDTH / 2;

            // Room Z boundaries
            const roomSouthZ = ROOM_S202_DEPTH / 2;    // South - windows (+Z)
            const roomNorthZ = -ROOM_S202_DEPTH / 2;   // North - corridor entry (-Z)

            // Three Star door position - near the SOUTH (window) end
            // From floor plan, door appears about 1.5m from the south wall
            const threeStarDoorCenterZ = roomSouthZ - 1.5;  // 1.5m from south wall
            const doorHalfWidth = DOOR_WIDTH / 2;

            // SOUTH segment: short wall between door and south wall (window wall)
            const southSegmentLength = roomSouthZ - (threeStarDoorCenterZ + doorHalfWidth);
            if (southSegmentLength > 0.05) {
                const leftWallSouth = new THREE.Mesh(
                    new THREE.BoxGeometry(WALL_THICKNESS, CEILING_HEIGHT, southSegmentLength),
                    wallMaterial
                );
                leftWallSouth.position.set(leftWallX, CEILING_HEIGHT / 2, roomSouthZ - southSegmentLength / 2);
                leftWallGroup.add(leftWallSouth);
            }

            // NORTH segment: long wall from door to north wall (runs past vestibule area)
            const northSegmentLength = (threeStarDoorCenterZ - doorHalfWidth) - roomNorthZ;
            if (northSegmentLength > 0.05) {
                const leftWallNorth = new THREE.Mesh(
                    new THREE.BoxGeometry(WALL_THICKNESS, CEILING_HEIGHT, northSegmentLength),
                    wallMaterial
                );
                leftWallNorth.position.set(leftWallX, CEILING_HEIGHT / 2, roomNorthZ + northSegmentLength / 2);
                leftWallGroup.add(leftWallNorth);
            }

            // Door header above the Three Star door
            const leftDoorHeader = new THREE.Mesh(
                new THREE.BoxGeometry(WALL_THICKNESS, CEILING_HEIGHT - DOOR_HEIGHT, DOOR_WIDTH),
                wallMaterial
            );
            leftDoorHeader.position.set(leftWallX, DOOR_HEIGHT + (CEILING_HEIGHT - DOOR_HEIGHT) / 2, threeStarDoorCenterZ);
            leftWallGroup.add(leftDoorHeader);

            // CLOSED DOOR to Three Star room (brown wood panel)
            const threeStarDoor = new THREE.Mesh(
                new THREE.BoxGeometry(0.05, DOOR_HEIGHT, DOOR_WIDTH),
                new THREE.MeshLambertMaterial({ color: 0x8B4513 })
            );
            threeStarDoor.position.set(leftWallX + 0.03, DOOR_HEIGHT / 2, threeStarDoorCenterZ);
            leftWallGroup.add(threeStarDoor);

            // Door handle (silver)
            const doorHandle = new THREE.Mesh(
                new THREE.BoxGeometry(0.03, 0.12, 0.03),
                new THREE.MeshLambertMaterial({ color: 0xC0C0C0 })
            );
            doorHandle.position.set(leftWallX + 0.07, DOOR_HEIGHT / 2, threeStarDoorCenterZ + doorHalfWidth - 0.15);
            leftWallGroup.add(doorHandle);

            group.add(leftWallGroup);
            roomS202Walls.left = leftWallGroup;

            // ========== RIGHT WALL (+X) - SOLID WALL shared with Room S203 ==========
            // NO door or passage between rooms - just a solid shared wall
            const rightWall = new THREE.Mesh(
                new THREE.BoxGeometry(WALL_THICKNESS, CEILING_HEIGHT, ROOM_S202_DEPTH),
                wallMaterial
            );
            rightWall.position.set(ROOM_S202_WIDTH / 2, CEILING_HEIGHT / 2, 0);
            group.add(rightWall);
            roomS202Walls.right = rightWall;

            // ========== CEILING ==========
            const ceilingS202 = new THREE.Mesh(new THREE.PlaneGeometry(ROOM_S202_WIDTH, ROOM_S202_DEPTH), wallMaterial);
            ceilingS202.rotation.x = Math.PI / 2;
            ceilingS202.position.set(0, CEILING_HEIGHT, 0);
            ceilingS202.userData.isCeiling = true;
            group.add(ceilingS202);

            // ========== PANAFRICAN-INSPIRED FURNITURE - S202 SPECIAL SPECIAL ==========
            // Layout: Entry from NORTH (-Z) through vestibule, Windows on SOUTH (+Z)
            // West wall (-X) has door to Three Star, East wall (+X) is shared with S203
            // Main room area starts after the vestibule

            const mainRoomZ = VESTIBULE_DEPTH / 2 + 0.8;  // Center of main room area
            const windowZ = ROOM_S202_DEPTH / 2 - 1.0;    // Near window wall

            // === DISPLAY TABLE with TIE-DYE CLOTH - center of main room ===
            const displayTable = new THREE.Mesh(new THREE.BoxGeometry(1.8, 0.72, 0.7), woodMaterial);
            displayTable.position.set(0, 0.36, mainRoomZ);
            group.add(displayTable);
            const tieDyeCloth = createTieDyeCloth();
            tieDyeCloth.position.set(0, 0, mainRoomZ);
            group.add(tieDyeCloth);

            // Books on table
            const bookStack1 = createBookStack();
            bookStack1.position.set(-0.4, 0.74, mainRoomZ);
            group.add(bookStack1);
            const bookStack2 = createBookStack();
            bookStack2.position.set(0.3, 0.74, mainRoomZ + 0.1);
            group.add(bookStack2);

            // === LISTENING AREA near windows (south wall) ===
            // Layered rugs on floor
            const mainRug = createLayeredRug(2.2, 1.8, 0xb71c1c);
            mainRug.position.set(0, 0, windowZ);
            group.add(mainRug);
            const africanNatte = createAfricanNatte();
            africanNatte.position.set(-0.2, 0.02, windowZ - 0.5);  // Moved back to stay inside room
            africanNatte.rotation.y = 0.1;
            group.add(africanNatte);

            // Bean bags for listening - arranged in a cozy circle
            const beanCream = createTriangleBeanbag(0xf5f0e8);
            beanCream.position.set(-0.6, 0, windowZ - 0.2);
            beanCream.rotation.y = 0.4;
            group.add(beanCream);
            const beanOrange = createTriangleBeanbag(0xfd7e14);
            beanOrange.position.set(0.5, 0, windowZ - 0.5);  // Moved inside room
            beanOrange.rotation.y = -0.3;
            group.add(beanOrange);

            // Cushions around the bean bags
            const cushion1 = createEthnicCushion([0xc41e3a, 0xfdd835]);
            cushion1.position.set(-0.1, 0, windowZ);
            group.add(cushion1);
            const cushion2 = createVelvetCushion(0x00897b);
            cushion2.position.set(0.2, 0, windowZ - 0.3);  // Moved inside room
            group.add(cushion2);
            const cushion3 = createPebbleCushion(0xc2185b);
            cushion3.position.set(-0.4, 0, windowZ - 0.4);  // Moved inside room
            group.add(cushion3);

            // === WEST WALL (-X): Book display near Three Star door ===
            const bookCubby = createBookCubby();
            bookCubby.position.set(-ROOM_S202_WIDTH / 2 + 0.3, 0, mainRoomZ - 0.5);
            bookCubby.rotation.y = Math.PI / 2;
            group.add(bookCubby);

            // === DECOR ===
            // Woven basket near east wall
            const basket = createWovenBasket();
            basket.position.set(ROOM_S202_WIDTH / 2 - 0.35, 0, mainRoomZ + 0.8);
            group.add(basket);
            // African pottery near window
            const pottery = createAfricanPottery();
            pottery.position.set(-ROOM_S202_WIDTH / 2 + 0.35, 0, windowZ - 0.3);  // Moved inside room
            group.add(pottery);

            // === PLANTS ===
            const hangingPlant = createHangingPlant();
            hangingPlant.position.set(ROOM_S202_WIDTH / 2 - 0.4, CEILING_HEIGHT - 0.3, windowZ);
            group.add(hangingPlant);

            // === LIGHTING ===
            // Ethiopian lamp over display table
            const ethiopianLamp = createEthiopianLamp();
            ethiopianLamp.position.set(0, CEILING_HEIGHT - 0.5, mainRoomZ);
            group.add(ethiopianLamp);
            // Disco ball over listening area
            const disco = createDiscoBall();
            disco.position.set(0, CEILING_HEIGHT - 0.3, windowZ);
            group.add(disco);

            return group;
        }

        // ============ ROOM S203 - READING ROOM ============
        // LAYOUT: Windows on FRONT (+Z), Door to corridor on BACK (-Z), Door to S202 on LEFT (-X)
        function createRoomS203() {
            const group = new THREE.Group();

            // Floor
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(ROOM_S203_WIDTH, ROOM_S203_DEPTH), floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.set(0, 0.01, 0);
            group.add(floor);

            // BACK WALL (-Z) - Door to corridor (door is positioned toward LEFT, not centered)
            // From floor plan: door is closer to the shared wall with S202
            const backWallGroup = new THREE.Group();
            const doorOffsetX = -ROOM_S203_WIDTH / 4;  // Door offset toward left (shared wall side)

            // Left wall section (small, between door and left wall)
            const leftWallWidth = ROOM_S203_WIDTH / 2 + doorOffsetX - DOOR_WIDTH / 2;
            if (leftWallWidth > 0.1) {
                const backWallLeft = new THREE.Mesh(
                    new THREE.BoxGeometry(leftWallWidth, CEILING_HEIGHT, WALL_THICKNESS),
                    brickMaterial
                );
                backWallLeft.position.set(-ROOM_S203_WIDTH / 2 + leftWallWidth / 2, CEILING_HEIGHT / 2, -ROOM_S203_DEPTH / 2);
                backWallGroup.add(backWallLeft);
            }

            // Right wall section (larger, most of the poster wall)
            const rightWallWidth = ROOM_S203_WIDTH / 2 - doorOffsetX - DOOR_WIDTH / 2;
            const backWallRight = new THREE.Mesh(
                new THREE.BoxGeometry(rightWallWidth, CEILING_HEIGHT, WALL_THICKNESS),
                brickMaterial
            );
            backWallRight.position.set(ROOM_S203_WIDTH / 2 - rightWallWidth / 2, CEILING_HEIGHT / 2, -ROOM_S203_DEPTH / 2);
            backWallGroup.add(backWallRight);

            // Door header
            const backDoorHeader = new THREE.Mesh(
                new THREE.BoxGeometry(DOOR_WIDTH, CEILING_HEIGHT - DOOR_HEIGHT, WALL_THICKNESS),
                brickMaterial
            );
            backDoorHeader.position.set(doorOffsetX, DOOR_HEIGHT + (CEILING_HEIGHT - DOOR_HEIGHT) / 2, -ROOM_S203_DEPTH / 2);
            backWallGroup.add(backDoorHeader);

            // Poster wall on right section (main poster wall area)
            const posterWall = createPosterWall(rightWallWidth - 0.2, CEILING_HEIGHT - 0.3);
            posterWall.position.set(ROOM_S203_WIDTH / 2 - rightWallWidth / 2, CEILING_HEIGHT / 2, -ROOM_S203_DEPTH / 2 + WALL_THICKNESS / 2 + 0.02);
            backWallGroup.add(posterWall);

            group.add(backWallGroup);
            roomS203Walls.back = backWallGroup;

            // FRONT WALL (+Z) - PS1 Industrial Windows (same style as S202)
            const frontWallGroup = new THREE.Group();

            // Wall below windows
            const frontWallBase = new THREE.Mesh(
                new THREE.BoxGeometry(ROOM_S203_WIDTH, PS1_WINDOW_SILL, WALL_THICKNESS),
                brickMaterial
            );
            frontWallBase.position.set(0, PS1_WINDOW_SILL / 2, ROOM_S203_DEPTH / 2);
            frontWallGroup.add(frontWallBase);

            // Wall above windows
            const topWallHeightS203 = CEILING_HEIGHT - PS1_WINDOW_SILL - PS1_WINDOW_HEIGHT;
            const frontWallTop = new THREE.Mesh(
                new THREE.BoxGeometry(ROOM_S203_WIDTH, topWallHeightS203, WALL_THICKNESS),
                brickMaterial
            );
            frontWallTop.position.set(0, PS1_WINDOW_SILL + PS1_WINDOW_HEIGHT + topWallHeightS203 / 2, ROOM_S203_DEPTH / 2);
            frontWallGroup.add(frontWallTop);

            // Room S203 is wider, so it can have 3 windows with 2 columns
            const windowCenterYS203 = PS1_WINDOW_SILL + PS1_WINDOW_HEIGHT / 2;
            const totalWindowArea = ROOM_S203_WIDTH - 0.4;  // Leave some wall on sides
            const numWindows = 3;
            const numColumns = 2;
            const windowWidthS203 = (totalWindowArea - numColumns * PS1_COLUMN_WIDTH) / numWindows;
            const windowSpacingS203 = windowWidthS203 + PS1_COLUMN_WIDTH;

            // Create 3 windows with columns between
            for (let i = 0; i < numWindows; i++) {
                const xPos = -totalWindowArea / 2 + windowWidthS203 / 2 + i * windowSpacingS203;
                const win = createPS1Window(windowWidthS203 * 0.9, PS1_WINDOW_HEIGHT);
                win.position.set(xPos, windowCenterYS203, ROOM_S203_DEPTH / 2 - 0.02);
                frontWallGroup.add(win);

                // Add column after each window except the last
                if (i < numWindows - 1) {
                    const col = createFlutedColumn(PS1_WINDOW_HEIGHT);
                    col.position.set(xPos + windowSpacingS203 / 2, PS1_WINDOW_SILL, ROOM_S203_DEPTH / 2 - 0.02);
                    frontWallGroup.add(col);
                }
            }

            // Side wall sections
            const sideWidthS203 = 0.2;
            const leftSideS203 = new THREE.Mesh(
                new THREE.BoxGeometry(sideWidthS203, PS1_WINDOW_HEIGHT, WALL_THICKNESS),
                brickMaterial
            );
            leftSideS203.position.set(-ROOM_S203_WIDTH / 2 + sideWidthS203 / 2, windowCenterYS203, ROOM_S203_DEPTH / 2);
            frontWallGroup.add(leftSideS203);

            const rightSideS203 = new THREE.Mesh(
                new THREE.BoxGeometry(sideWidthS203, PS1_WINDOW_HEIGHT, WALL_THICKNESS),
                brickMaterial
            );
            rightSideS203.position.set(ROOM_S203_WIDTH / 2 - sideWidthS203 / 2, windowCenterYS203, ROOM_S203_DEPTH / 2);
            frontWallGroup.add(rightSideS203);

            group.add(frontWallGroup);
            roomS203Walls.front = frontWallGroup;

            // LEFT WALL (-X) - SOLID WALL shared with Room S202
            // NO door or passage between rooms - just a solid shared wall
            const leftWall = new THREE.Mesh(
                new THREE.BoxGeometry(WALL_THICKNESS, CEILING_HEIGHT, ROOM_S203_DEPTH),
                brickMaterial
            );
            leftWall.position.set(-ROOM_S203_WIDTH / 2, CEILING_HEIGHT / 2, 0);
            group.add(leftWall);
            roomS203Walls.left = leftWall;

            // RIGHT WALL (+X) - Solid exterior wall
            const rightWall = new THREE.Mesh(new THREE.BoxGeometry(WALL_THICKNESS, CEILING_HEIGHT, ROOM_S203_DEPTH), brickMaterial);
            rightWall.position.set(ROOM_S203_WIDTH / 2, CEILING_HEIGHT / 2, 0);
            group.add(rightWall);
            roomS203Walls.right = rightWall;

            // Ceiling
            const ceilingS203 = new THREE.Mesh(new THREE.PlaneGeometry(ROOM_S203_WIDTH, ROOM_S203_DEPTH), wallMaterial);
            ceilingS203.rotation.x = Math.PI / 2;
            ceilingS203.position.set(0, CEILING_HEIGHT, 0);
            ceilingS203.userData.isCeiling = true;
            group.add(ceilingS203);

            // ========== FENG SHUI FURNITURE LAYOUT - READING ROOM S203 ==========
            // FENG SHUI PRINCIPLES APPLIED:
            // 1. COMMANDING POSITION: Main seating faces door but not directly in line
            // 2. CLEAR CHI FLOW: Entry path kept clear, no blocking doorways
            // 3. INTIMATE CONVERSATION: Seating arranged to face each other
            // 4. GROUNDING: Heavy furniture against walls, not floating
            // 5. BALANCE: Symmetry where possible, visual weight distributed

            // Room: 4.465m wide (X) x 7.715m deep (Z)
            // Door on NORTH wall (-Z) at x = -1.1m (LEFT side of back wall)
            // Windows on SOUTH wall (+Z)
            // ROOM_S203_WIDTH = 4.465, ROOM_S203_DEPTH = 7.715

            // === ZONE 1: ENTRY AREA (back/north, z < -2) - KEEP CLEAR ===
            // Door is at x=-1.1, so entry flows from left side toward center

            // Bookcase FLAT AGAINST back wall, FAR RIGHT (away from door!)
            // Door is at x=-1.1, so put bookcase at x=1.5 (right side)
            const wallBookcase = createWallBookcase();
            wallBookcase.position.set(1.5, 0, -ROOM_S203_DEPTH / 2 + 0.35);  // Against back wall, right side
            group.add(wallBookcase);

            // Small sculpture near door as welcoming element (but not blocking)
            const sculpture = createWoodSculpture();
            sculpture.position.set(0.5, 0, -ROOM_S203_DEPTH / 2 + 0.5);  // Right of entry path
            group.add(sculpture);

            // === ZONE 2: MAIN SEATING AREA (center, -2 < z < 2) ===
            // COMMANDING POSITION: Sofa against solid wall, facing door diagonally

            // Main rug defines the conversation area - centered
            const mainRug = createLayeredRug(2.5, 2.0, 0xb71c1c);
            mainRug.position.set(0, 0, 0.5);  // Center of room
            group.add(mainRug);

            // Olive sofa against LEFT WALL (solid wall = security/support)
            // Facing toward door and center - commanding position
            const oliveSofa = createOliveSofa();
            oliveSofa.position.set(-ROOM_S203_WIDTH / 2 + 0.55, 0, 0.5);
            oliveSofa.rotation.y = Math.PI / 2;  // Faces right/center
            group.add(oliveSofa);

            // Pink armchair against RIGHT WALL, facing sofa (conversation layout)
            const pinkChair = createPinkArmchair();
            pinkChair.position.set(ROOM_S203_WIDTH / 2 - 0.5, 0, 0.3);
            pinkChair.rotation.y = -Math.PI / 2;  // Faces left toward sofa
            group.add(pinkChair);

            // Bean bags ON THE RUG, arranged in conversation circle
            // These face inward toward each other
            const beanCream = createTriangleBeanbag(0xf5f0e8);
            beanCream.position.set(-0.3, 0, -0.3);  // Back of rug
            beanCream.rotation.y = 0.3;
            group.add(beanCream);

            const beanOrange = createTriangleBeanbag(0xfd7e14);
            beanOrange.position.set(0.5, 0, 0.7);  // Front right of rug
            beanOrange.rotation.y = -0.5;
            group.add(beanOrange);

            const beanMagenta = createTriangleBeanbag(0xc2185b);
            beanMagenta.position.set(-0.2, 0, 1.2);  // Front of rug
            beanMagenta.rotation.y = Math.PI;
            group.add(beanMagenta);

            // Floor cushions scattered naturally on/around rug
            const cushion1 = createEthnicCushion([0xc41e3a, 0xfdd835]);
            cushion1.position.set(0.2, 0, 0.2);
            group.add(cushion1);
            const cushion2 = createVelvetCushion(0x00897b);
            cushion2.position.set(0.6, 0, 1.0);
            group.add(cushion2);
            const cushion3 = createPebbleCushion(0x9c27b0);
            cushion3.position.set(-0.5, 0, 0.8);
            group.add(cushion3);

            // Low coffee table in center of seating area
            const coffeeTable = createLowCoffeeTable();
            coffeeTable.position.set(0.1, 0, 0.5);
            group.add(coffeeTable);

            // Book cubby against RIGHT WALL (between armchair and window area)
            const bookCubby = createBookCubby();
            bookCubby.position.set(ROOM_S203_WIDTH / 2 - 0.25, 0, 1.5);
            bookCubby.rotation.y = -Math.PI / 2;  // Faces into room
            group.add(bookCubby);

            // === ZONE 3: WINDOW/READING AREA (front/south, z > 2) ===
            // Light, airy zone near windows for reading

            // Plants in corners (wood element, life energy)
            const palm1 = createPalmPlant();
            palm1.position.set(ROOM_S203_WIDTH / 2 - 0.4, 0, ROOM_S203_DEPTH / 2 - 0.5);
            group.add(palm1);
            const palm2 = createPalmPlant();
            palm2.position.set(-ROOM_S203_WIDTH / 2 + 0.4, 0, ROOM_S203_DEPTH / 2 - 0.5);
            group.add(palm2);

            // Decorative elements in corners (earth element)
            const basket = createWovenBasket();
            basket.position.set(ROOM_S203_WIDTH / 2 - 0.35, 0, 2.5);
            group.add(basket);
            const pottery = createAfricanPottery();
            pottery.position.set(-ROOM_S203_WIDTH / 2 + 0.35, 0, 2.5);
            group.add(pottery);

            // === LIGHTING: Balanced, warm ===
            // Central disco ball cluster (reflects light/energy)
            const discoBalls = createDiscoBallCluster();
            discoBalls.position.set(0, CEILING_HEIGHT - 0.4, 0.5);
            group.add(discoBalls);

            // Ethiopian lamps for warm ambient light
            const ethLamp1 = createEthiopianLamp();
            ethLamp1.position.set(-0.8, CEILING_HEIGHT - 0.5, -1.0);
            group.add(ethLamp1);
            const ethLamp2 = createEthiopianLamp();
            ethLamp2.position.set(0.8, CEILING_HEIGHT - 0.5, 2.0);
            group.add(ethLamp2);

            // String lights along window wall (festive, inviting)
            const stringLights = createStringLights();
            stringLights.position.set(0, CEILING_HEIGHT - 0.5, ROOM_S203_DEPTH / 2 - 0.3);
            group.add(stringLights);

            // Hanging plant (brings life energy down)
            const hangingPlant1 = createHangingPlant();
            hangingPlant1.position.set(1.0, CEILING_HEIGHT - 0.3, 2.0);
            group.add(hangingPlant1);

            return group;
        }

        // Create and position rooms
        const roomS202 = createRoomS202();
        roomS202.position.set(ROOM_S202_X, 0, 0);
        scene.add(roomS202);

        const roomS203 = createRoomS203();
        roomS203.position.set(ROOM_S203_X, 0, 0);
        scene.add(roomS203);

        // Room labels
        function createLabel(text, position) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 128;
            ctx.fillStyle = 'rgba(0,0,0,0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.font = 'bold 32px Helvetica';
            ctx.textAlign = 'center';
            ctx.fillText(text, canvas.width / 2, canvas.height / 2 + 10);
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(material);
            sprite.scale.set(2.5, 0.6, 1);
            sprite.position.copy(position);
            return sprite;
        }

        labelsGroup.add(createLabel('ROOM S202 - SPECIAL SPECIAL', new THREE.Vector3(ROOM_S202_X, CEILING_HEIGHT + 0.5, 0)));
        labelsGroup.add(createLabel('ROOM S203 - READING ROOM', new THREE.Vector3(ROOM_S203_X, CEILING_HEIGHT + 0.5, 0)));
        scene.add(labelsGroup);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.7);
        directionalLight.position.set(10, 15, 10);
        directionalLight.castShadow = true;
        scene.add(directionalLight);
        const fillLight = new THREE.DirectionalLight(0xffffff, 0.3);
        fillLight.position.set(-10, 10, -10);
        scene.add(fillLight);
        const roomS202Light = new THREE.PointLight(0xffffee, 0.4, 12);
        roomS202Light.position.set(ROOM_S202_X, CEILING_HEIGHT - 0.5, 0);
        scene.add(roomS202Light);
        const roomS203Light = new THREE.PointLight(0xffffee, 0.4, 12);
        roomS203Light.position.set(ROOM_S203_X, CEILING_HEIGHT - 0.5, 0);
        scene.add(roomS203Light);

        // Camera controls
        let isMouseDown = false;
        let mouseX = 0, mouseY = 0;
        let targetRotationX = 0, targetRotationY = 0.4;
        let currentRotationX = 0, currentRotationY = 0.4;
        let cameraDistance = 18;
        let cameraTarget = new THREE.Vector3(0, 2, 0);

        camera.position.set(0, 12, 18);
        camera.lookAt(cameraTarget);

        container.addEventListener('mousedown', (e) => { isMouseDown = true; mouseX = e.clientX; mouseY = e.clientY; });
        container.addEventListener('mouseup', () => isMouseDown = false);
        container.addEventListener('mouseleave', () => isMouseDown = false);

        container.addEventListener('mousemove', (e) => {
            if (!isMouseDown) return;
            targetRotationX += (e.clientX - mouseX) * 0.005;
            targetRotationY += (e.clientY - mouseY) * 0.005;
            targetRotationY = Math.max(-0.5, Math.min(1.2, targetRotationY));
            mouseX = e.clientX; mouseY = e.clientY;
        });

        container.addEventListener('wheel', (e) => {
            cameraDistance += e.deltaY * 0.01;
            cameraDistance = Math.max(3, Math.min(35, cameraDistance));
        });

        const keys = {};
        document.addEventListener('keydown', (e) => keys[e.key.toLowerCase()] = true);
        document.addEventListener('keyup', (e) => keys[e.key.toLowerCase()] = false);

        // Touch controls
        container.addEventListener('touchstart', (e) => { isMouseDown = true; mouseX = e.touches[0].clientX; mouseY = e.touches[0].clientY; });
        container.addEventListener('touchend', () => isMouseDown = false);
        container.addEventListener('touchmove', (e) => {
            if (!isMouseDown) return;
            targetRotationX += (e.touches[0].clientX - mouseX) * 0.005;
            targetRotationY += (e.touches[0].clientY - mouseY) * 0.005;
            targetRotationY = Math.max(-0.5, Math.min(1.2, targetRotationY));
            mouseX = e.touches[0].clientX; mouseY = e.touches[0].clientY;
        });

        // View presets - CORRECTED FOR DOOR ENTRY PERSPECTIVE
        // Entry views: Camera at BACK (door, -Z) looking FORWARD toward windows (+Z)
        // rotX=0 means camera is at front looking back, rotX=Math.PI means camera at back looking forward
        const views = {
            overview: { rotX: 0, rotY: 0.5, dist: 18, target: new THREE.Vector3(0, 2, 0) },
            floorPlan: { rotX: 0, rotY: 1.5, dist: 14, target: new THREE.Vector3(0, 0, 0) },
            // Room S202 views - Entry through vestibule door, looking toward windows
            // rotX=Math.PI puts camera at -Z (door) looking toward +Z (windows)
            roomS202Entry: { rotX: Math.PI, rotY: 0.15, dist: 3, target: new THREE.Vector3(ROOM_S202_X, 1.5, -ROOM_S202_DEPTH / 2 + 1) },
            roomS202Inside: { rotX: Math.PI, rotY: 0.2, dist: 5, target: new THREE.Vector3(ROOM_S202_X, 1.5, 0) },
            roomS202Windows: { rotX: Math.PI, rotY: 0.15, dist: 4, target: new THREE.Vector3(ROOM_S202_X, 1.5, ROOM_S202_DEPTH / 4) },
            roomS202Table: { rotX: Math.PI * 0.8, rotY: 0.25, dist: 4, target: new THREE.Vector3(ROOM_S202_X, 0.8, 0) },
            // Room S203 views - Entry through corridor door, looking toward arched windows
            roomS203Entry: { rotX: Math.PI, rotY: 0.15, dist: 3, target: new THREE.Vector3(ROOM_S203_X, 1.5, -ROOM_S203_DEPTH / 2 + 1) },
            roomS203Inside: { rotX: Math.PI, rotY: 0.2, dist: 6, target: new THREE.Vector3(ROOM_S203_X, 1.5, 0) },
            roomS203Windows: { rotX: Math.PI, rotY: 0.15, dist: 4, target: new THREE.Vector3(ROOM_S203_X, 1.5, ROOM_S203_DEPTH / 4) },
            roomS203Seating: { rotX: Math.PI * 0.7, rotY: 0.2, dist: 4, target: new THREE.Vector3(ROOM_S203_X, 0.5, 0.5) },
            roomS203Shelves: { rotX: Math.PI * 1.2, rotY: 0.2, dist: 5, target: new THREE.Vector3(ROOM_S203_X, 1.2, -ROOM_S203_DEPTH / 3) }
        };

        function animateToView(view, duration = 1500) {
            const startRotX = currentRotationX, startRotY = currentRotationY;
            const startDist = cameraDistance;
            const startTarget = cameraTarget.clone();
            const startTime = Date.now();

            function update() {
                const elapsed = Date.now() - startTime;
                const t = Math.min(elapsed / duration, 1);
                const eased = t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2;

                targetRotationX = startRotX + (view.rotX - startRotX) * eased;
                targetRotationY = startRotY + (view.rotY - startRotY) * eased;
                cameraDistance = startDist + (view.dist - startDist) * eased;
                cameraTarget.lerpVectors(startTarget, view.target, eased);

                if (t < 1) requestAnimationFrame(update);
            }
            update();
        }

        window.setView = function(viewName) { const view = views[viewName]; if (view) animateToView(view); };
        window.focusRoom = function(room) {
            if (room === 'roomS202') setView('roomS202Inside');
            else if (room === 'roomS203') setView('roomS203Inside');
        };

        let tourRunning = false;
        window.startTour = function() {
            if (tourRunning) return;
            tourRunning = true;
            // Tour starts from entry doors, walking through each room
            const stops = ['overview', 'roomS202Entry', 'roomS202Inside', 'roomS202Windows', 'roomS202Table', 'roomS203Entry', 'roomS203Inside', 'roomS203Windows', 'roomS203Seating', 'roomS203Shelves', 'overview'];
            let i = 0;
            function next() {
                if (i >= stops.length) { tourRunning = false; return; }
                animateToView(views[stops[i++]], 2000);
                setTimeout(next, 3500);
            }
            next();
        };

        // Toggle functions
        let showGrid = true, showLabels = true, showCeiling = true, hideNearWall = false, showWireframe = false;

        window.toggleGrid = function() {
            showGrid = !showGrid;
            gridHelper.visible = showGrid;
            document.getElementById('gridBtn').classList.toggle('active', showGrid);
        };

        window.toggleLabels = function() {
            showLabels = !showLabels;
            labelsGroup.visible = showLabels;
            document.getElementById('labelsBtn').classList.toggle('active', showLabels);
        };

        window.toggleCeiling = function() {
            showCeiling = !showCeiling;
            // Find all ceilings in the scene
            scene.traverse((obj) => {
                if (obj.userData.isCeiling) obj.visible = showCeiling;
            });
            document.getElementById('ceilingBtn').classList.toggle('active', showCeiling);
        };

        window.toggleNearWall = function() {
            hideNearWall = !hideNearWall;
            document.getElementById('nearWallBtn').classList.toggle('active', hideNearWall);
        };

        window.toggleWireframe = function() {
            showWireframe = !showWireframe;
            document.getElementById('wireframeBtn').classList.toggle('active', showWireframe);
            scene.traverse((obj) => { if (obj.isMesh && obj.material) obj.material.wireframe = showWireframe; });
        };

        window.captureScreenshot = function() {
            const link = document.createElement('a');
            link.download = 'PanafricanLibrary_ReadingRoom.png';
            link.href = renderer.domElement.toDataURL('image/png');
            link.click();
        };

        window.toggleMoodboard = function() {
            const modal = document.getElementById('moodboard-modal');
            modal.classList.toggle('modal-hidden');
        };

        // ============ DECORATOR MODE ============
        let decoratorMode = false;
        let selectedFurnitureType = null;
        let selectedPlacedItem = null;
        let placedItems = [];
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.toggleDecorator = function() {
            const panel = document.getElementById('decorator-panel');
            panel.classList.toggle('open');
            decoratorMode = panel.classList.contains('open');
            if (!decoratorMode) {
                deselectAll();
            }
        };

        window.toggleCategory = function(catId) {
            document.getElementById(catId).classList.toggle('collapsed');
        };

        window.selectFurniture = function(type) {
            // Deselect previous
            document.querySelectorAll('.item-card').forEach(c => c.classList.remove('selected'));
            // Select new
            event.currentTarget.classList.add('selected');
            selectedFurnitureType = type;
            selectedPlacedItem = null;
            updateSelectedInfo();
        };

        function deselectAll() {
            document.querySelectorAll('.item-card').forEach(c => c.classList.remove('selected'));
            selectedFurnitureType = null;
            selectedPlacedItem = null;
            updateSelectedInfo();
        }

        function updateSelectedInfo() {
            const info = document.getElementById('selected-item-info');
            const nameSpan = document.getElementById('selected-name');
            if (selectedPlacedItem) {
                info.classList.add('visible');
                nameSpan.textContent = selectedPlacedItem.userData.itemType || 'Item';
            } else if (selectedFurnitureType) {
                info.classList.add('visible');
                nameSpan.textContent = selectedFurnitureType + ' (click to place)';
            } else {
                info.classList.remove('visible');
            }
        }

        // Create furniture based on type
        function createFurnitureItem(type) {
            let item;
            switch(type) {
                // Bean Bags - large triangular
                case 'beanbag-cream': item = createTriangleBeanbag(0xf5f0e8); break;
                case 'beanbag-orange': item = createTriangleBeanbag(0xfd7e14); break;
                case 'beanbag-magenta': item = createTriangleBeanbag(0xc2185b); break;
                case 'beanbag-teal': item = createTriangleBeanbag(0x26a69a); break;
                // Ethnic cushions
                case 'cushion-ethnic-orange': item = createEthnicCushion(0xfd7e14, 0xc96000); break;
                case 'cushion-ethnic-burgundy': item = createEthnicCushion(0x8b2942, 0x5a1a2a); break;
                case 'cushion-velvet-teal': item = createFloorCushion(0x00897b, 0.55); break;
                case 'cushion-round-green': item = createFloorCushion(0x7cb342, 0.45); break;
                case 'cushion-pebble-gray': item = createPebbleCushion(0x90a4ae); break;
                // Mattress & Seating
                case 'mattress-ochre': item = createTuftedFloorMattress(2.2, 1.4); break;
                case 'sofa-olive': item = createVelvetSofa(0x827717); break;
                case 'armchair-pink': item = createVintageArmchair(0xe91e63); break;
                // Tables
                case 'table-display': item = createDisplayTable(); break;
                case 'table-coffee': item = createLowCoffeeTable(); break;
                case 'table-side': item = createSideTable(); break;
                case 'bench-wood': item = createWoodenBench(); break;
                // Book Displays & Storage
                case 'bookcase-wall': item = createWallBookcase(); break;
                case 'book-cubby': item = createBookCubby(); break;
                case 'magazine-rack': item = createMagazineRack(); break;
                case 'book-stack': item = createBookStack(); break;
                case 'display-pink': item = createColorDisplay(0xf8bbd0); break;
                case 'shelf-leaning': item = createLeaningShelf(); break;
                // Rugs - Layered Persian & African
                case 'rug-persian-red': item = createLayeredRug(3.5, 2.5, 0xb71c1c); break;
                case 'rug-persian-cream': item = createLayeredRug(3.0, 2.2, 0xefebe9); break;
                case 'rug-natte-african': item = createAfricanNatte(); break;
                case 'rug-checkered-pink': item = createCheckeredRug(0xe91e63, 0xf8bbd0); break;
                case 'rug-checkered-teal': item = createCheckeredRug(0x00897b, 0xb2dfdb); break;
                case 'rug-wax-yellow': item = createWaxPrintRug(0xfdd835, 0xc41e3a); break;
                case 'rug-geometric-bw': item = createGeometricRug(); break;
                case 'tablecloth-tiedye': item = createTieDyeCloth(); break;
                // Lighting - Ethiopian & Disco
                case 'lamp-ethiopian': item = createEthiopianLamp(); break;
                case 'lamp-beaded': item = createBeadedLamp(); break;
                case 'disco-ball': item = createDiscoBall(); break;
                case 'disco-ball-cluster': item = createDiscoBallCluster(); break;
                case 'light-string': item = createStringLights(); break;
                case 'lantern-paper': item = createPaperLantern(); break;
                // Plants & African Decor
                case 'plant-palm': item = createPalmPlant(); break;
                case 'plant-hanging': item = createHangingPlant(); break;
                case 'plant-pothos': item = createPothosVine(); break;
                case 'basket-woven': item = createWovenBasket(); break;
                case 'pottery-african': item = createAfricanPottery(); break;
                case 'sculpture-wood': item = createWoodSculpture(); break;
                // Wall art
                case 'poster-afrikadaa-1': item = createWallPoster(0xff6b6b, 0.6, 0.8, 'Afrikadaa #1'); break;
                case 'poster-afrikadaa-2': item = createWallPoster(0x45b7d1, 0.5, 0.7, 'Afrikadaa #2'); break;
                case 'poster-afrikadaa-3': item = createWallPoster(0xe17055, 0.5, 0.65, 'African Art'); break;
                case 'poster-coolhunt-1': item = createWallPoster(0x1a1a1a, 0.5, 0.7, 'Fashion'); break;
                case 'poster-coolhunt-2': item = createWallPoster(0xc41e3a, 0.6, 0.8, 'Street Art'); break;
                case 'poster-coolhunt-3': item = createWallPoster(0x74b9ff, 0.4, 0.5, 'Design'); break;
                case 'poster-activist-1': item = createTextBanner('WE WANT TO LIVE FREE', 0x1a3a5c); break;
                case 'poster-activist-2': item = createTextBanner('SOMOS PERSONAS', 0xf5f0e8, 0x1a1a1a); break;
                case 'poster-activist-3': item = createWallPoster(0xc41e3a, 0.7, 0.9, 'Resistance'); break;
                default: item = createFloorCushion(0x888888, 0.5);
            }
            item.userData.itemType = type;
            item.userData.isPlacedItem = true;
            return item;
        }

        // Additional furniture creation functions
        function createBeanbag(color) {
            const group = new THREE.Group();
            const bean = new THREE.Mesh(
                new THREE.SphereGeometry(0.45, 16, 16),
                new THREE.MeshLambertMaterial({ color })
            );
            bean.scale.set(1.2, 0.7, 1);
            bean.position.set(0, 0.3, 0);
            group.add(bean);
            return group;
        }

        function createLowSofa() {
            const group = new THREE.Group();
            const mat = new THREE.MeshLambertMaterial({ color: 0x6c757d });
            const seat = new THREE.Mesh(new THREE.BoxGeometry(1.8, 0.3, 0.8), mat);
            seat.position.set(0, 0.25, 0);
            group.add(seat);
            const back = new THREE.Mesh(new THREE.BoxGeometry(1.8, 0.4, 0.15), mat);
            back.position.set(0, 0.5, -0.35);
            group.add(back);
            const armL = new THREE.Mesh(new THREE.BoxGeometry(0.15, 0.35, 0.8), mat);
            armL.position.set(-0.85, 0.35, 0);
            group.add(armL);
            const armR = new THREE.Mesh(new THREE.BoxGeometry(0.15, 0.35, 0.8), mat);
            armR.position.set(0.85, 0.35, 0);
            group.add(armR);
            return group;
        }

        function createDisplayTable() {
            const group = new THREE.Group();
            const tableMat = new THREE.MeshLambertMaterial({ color: 0xd4a76a });
            const top = new THREE.Mesh(new THREE.BoxGeometry(2, 0.04, 0.8), tableMat);
            top.position.set(0, 0.72, 0);
            group.add(top);
            const legs = [[0.9, 0.3], [0.9, -0.3], [-0.9, 0.3], [-0.9, -0.3]];
            legs.forEach(([x, z]) => {
                const leg = new THREE.Mesh(new THREE.BoxGeometry(0.05, 0.7, 0.05), tableMat);
                leg.position.set(x, 0.35, z);
                group.add(leg);
            });
            return group;
        }

        function createSideTable() {
            const group = new THREE.Group();
            const mat = new THREE.MeshLambertMaterial({ color: 0xffd93d });
            const top = new THREE.Mesh(new THREE.CylinderGeometry(0.25, 0.25, 0.03, 16), mat);
            top.position.set(0, 0.45, 0);
            group.add(top);
            const leg = new THREE.Mesh(new THREE.CylinderGeometry(0.03, 0.04, 0.43, 8), mat);
            leg.position.set(0, 0.22, 0);
            group.add(leg);
            return group;
        }

        function createWoodenBench() {
            const group = new THREE.Group();
            const mat = new THREE.MeshLambertMaterial({ color: 0xd4a76a });
            const seat = new THREE.Mesh(new THREE.BoxGeometry(1.5, 0.05, 0.4), mat);
            seat.position.set(0, 0.45, 0);
            group.add(seat);
            const legs = [[0.65, 0.1], [0.65, -0.1], [-0.65, 0.1], [-0.65, -0.1]];
            legs.forEach(([x, z]) => {
                const leg = new THREE.Mesh(new THREE.BoxGeometry(0.05, 0.43, 0.05), mat);
                leg.position.set(x, 0.22, z);
                group.add(leg);
            });
            return group;
        }

        function createFoldingScreen() {
            const group = new THREE.Group();
            const mat = new THREE.MeshLambertMaterial({ color: 0xd4a76a, side: THREE.DoubleSide });
            for (let i = -1; i <= 1; i++) {
                const panel = new THREE.Mesh(new THREE.BoxGeometry(0.6, 1.8, 0.02), mat);
                panel.position.set(i * 0.5, 0.9, i * 0.1);
                panel.rotation.y = i * 0.3;
                group.add(panel);
            }
            return group;
        }

        function createWireRack() {
            const group = new THREE.Group();
            const mat = new THREE.MeshLambertMaterial({ color: 0x888888 });
            for (let y = 0; y < 4; y++) {
                const shelf = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.02, 0.3), mat);
                shelf.position.set(0, 0.3 + y * 0.3, 0);
                group.add(shelf);
            }
            const legs = [[0.18, 0.13], [0.18, -0.13], [-0.18, 0.13], [-0.18, -0.13]];
            legs.forEach(([x, z]) => {
                const leg = new THREE.Mesh(new THREE.CylinderGeometry(0.01, 0.01, 1.2, 8), mat);
                leg.position.set(x, 0.6, z);
                group.add(leg);
            });
            return group;
        }

        function createStripedRug() {
            const group = new THREE.Group();
            const colors = [0xc9a227, 0x8b6914, 0xc9a227, 0x8b6914, 0xc9a227];
            const stripeWidth = 0.6;
            colors.forEach((color, i) => {
                const stripe = new THREE.Mesh(
                    new THREE.BoxGeometry(stripeWidth, 0.02, 2.5),
                    new THREE.MeshLambertMaterial({ color })
                );
                stripe.position.set((i - 2) * stripeWidth, 0.01, 0);
                group.add(stripe);
            });
            return group;
        }

        function createTablecloth(color) {
            const group = new THREE.Group();
            const cloth = new THREE.Mesh(
                new THREE.BoxGeometry(2.1, 0.02, 0.9),
                new THREE.MeshLambertMaterial({ color })
            );
            cloth.position.set(0, 0.74, 0);
            group.add(cloth);
            return group;
        }

        function createFloorLamp() {
            const group = new THREE.Group();
            const mat = new THREE.MeshLambertMaterial({ color: 0xf5f5f5 });
            const base = new THREE.Mesh(new THREE.CylinderGeometry(0.15, 0.18, 0.03, 16), mat);
            base.position.set(0, 0.015, 0);
            group.add(base);
            const pole = new THREE.Mesh(new THREE.CylinderGeometry(0.02, 0.02, 1.5, 8), mat);
            pole.position.set(0, 0.78, 0);
            group.add(pole);
            const shade = new THREE.Mesh(
                new THREE.ConeGeometry(0.2, 0.25, 16, 1, true),
                new THREE.MeshLambertMaterial({ color: 0xf5f5dc, side: THREE.DoubleSide })
            );
            shade.position.set(0, 1.6, 0);
            shade.rotation.x = Math.PI;
            group.add(shade);
            return group;
        }

        function createDiscoBall() {
            const group = new THREE.Group();
            const ball = new THREE.Mesh(
                new THREE.SphereGeometry(0.15, 16, 16),
                new THREE.MeshLambertMaterial({ color: 0xc0c0c0 })
            );
            ball.position.set(0, 0, 0);
            group.add(ball);
            const cord = new THREE.Mesh(
                new THREE.CylinderGeometry(0.01, 0.01, 0.5, 8),
                new THREE.MeshLambertMaterial({ color: 0x333333 })
            );
            cord.position.set(0, 0.25, 0);
            group.add(cord);
            return group;
        }

        function createSmallPlant() {
            const group = new THREE.Group();
            const pot = new THREE.Mesh(
                new THREE.CylinderGeometry(0.08, 0.06, 0.12, 12),
                new THREE.MeshLambertMaterial({ color: 0x8b4513 })
            );
            pot.position.set(0, 0.06, 0);
            group.add(pot);
            const plant = new THREE.Mesh(
                new THREE.SphereGeometry(0.1, 8, 8),
                new THREE.MeshLambertMaterial({ color: 0x32cd32 })
            );
            plant.position.set(0, 0.18, 0);
            group.add(plant);
            return group;
        }

        function createVase() {
            const group = new THREE.Group();
            const vase = new THREE.Mesh(
                new THREE.CylinderGeometry(0.08, 0.12, 0.25, 12),
                new THREE.MeshLambertMaterial({ color: 0x4169e1 })
            );
            vase.position.set(0, 0.125, 0);
            group.add(vase);
            const flowers = new THREE.Mesh(
                new THREE.SphereGeometry(0.12, 8, 8),
                new THREE.MeshLambertMaterial({ color: 0xff69b4 })
            );
            flowers.position.set(0, 0.35, 0);
            group.add(flowers);
            return group;
        }

        function createWallPoster(color, width, height, text) {
            const group = new THREE.Group();
            const poster = new THREE.Mesh(
                new THREE.BoxGeometry(width, height, 0.02),
                new THREE.MeshLambertMaterial({ color })
            );
            poster.position.set(0, height/2, 0);
            group.add(poster);
            // Frame
            const frameMat = new THREE.MeshLambertMaterial({ color: 0x1a1a1a });
            const frameT = new THREE.Mesh(new THREE.BoxGeometry(width + 0.04, 0.02, 0.03), frameMat);
            frameT.position.set(0, height + 0.01, 0.01);
            group.add(frameT);
            const frameB = new THREE.Mesh(new THREE.BoxGeometry(width + 0.04, 0.02, 0.03), frameMat);
            frameB.position.set(0, -0.01, 0.01);
            group.add(frameB);
            const frameL = new THREE.Mesh(new THREE.BoxGeometry(0.02, height + 0.04, 0.03), frameMat);
            frameL.position.set(-width/2 - 0.01, height/2, 0.01);
            group.add(frameL);
            const frameR = new THREE.Mesh(new THREE.BoxGeometry(0.02, height + 0.04, 0.03), frameMat);
            frameR.position.set(width/2 + 0.01, height/2, 0.01);
            group.add(frameR);
            group.userData.isWallArt = true;
            return group;
        }

        function createTextBanner(text, bgColor, textColor = 0xffffff) {
            const group = new THREE.Group();
            const banner = new THREE.Mesh(
                new THREE.BoxGeometry(0.8, 1.0, 0.02),
                new THREE.MeshLambertMaterial({ color: bgColor })
            );
            banner.position.set(0, 0.5, 0);
            group.add(banner);
            group.userData.isWallArt = true;
            group.userData.bannerText = text;
            return group;
        }

        // ==========================================
        // PANAFRICAN-INSPIRED FURNITURE FUNCTIONS
        // Based on reference images from the mood board
        // ==========================================

        // TRIANGLE BEAN BAGS - Large triangular floor cushions
        function createTriangleBeanbag(color) {
            const group = new THREE.Group();
            // Large triangular floor cushion/beanbag - FLAT on the floor
            // Using a flattened cylinder (like a thick triangular cushion)
            const height = 0.2;  // Low to the ground
            const radius = 0.55;
            const geometry = new THREE.CylinderGeometry(radius * 0.3, radius, height, 3);
            const material = new THREE.MeshLambertMaterial({ color });
            const bean = new THREE.Mesh(geometry, material);
            bean.rotation.y = Math.PI / 6;  // Rotate for visual interest
            bean.position.set(0, height / 2, 0);  // Sits flat on floor (y=0)
            group.add(bean);
            return group;
        }

        // ETHNIC/VELVET CUSHIONS - Colorful floor cushions
        function createEthnicCushion(colors) {
            const group = new THREE.Group();
            const cushion = new THREE.Mesh(
                new THREE.BoxGeometry(0.5, 0.15, 0.5),
                new THREE.MeshLambertMaterial({ color: colors[0] })
            );
            cushion.position.set(0, 0.08, 0);
            group.add(cushion);
            // Add pattern stripe
            const stripe = new THREE.Mesh(
                new THREE.BoxGeometry(0.52, 0.02, 0.1),
                new THREE.MeshLambertMaterial({ color: colors[1] || 0xffd700 })
            );
            stripe.position.set(0, 0.16, 0);
            group.add(stripe);
            return group;
        }

        function createVelvetCushion(color) {
            const group = new THREE.Group();
            const cushion = new THREE.Mesh(
                new THREE.BoxGeometry(0.45, 0.12, 0.45),
                new THREE.MeshLambertMaterial({ color })
            );
            cushion.position.set(0, 0.06, 0);
            group.add(cushion);
            // Tufted center button
            const button = new THREE.Mesh(
                new THREE.CylinderGeometry(0.03, 0.03, 0.02, 8),
                new THREE.MeshLambertMaterial({ color: 0x333333 })
            );
            button.position.set(0, 0.13, 0);
            group.add(button);
            return group;
        }

        function createPebbleCushion(color) {
            const group = new THREE.Group();
            const cushion = new THREE.Mesh(
                new THREE.SphereGeometry(0.25, 12, 12),
                new THREE.MeshLambertMaterial({ color })
            );
            cushion.scale.set(1, 0.4, 1);
            cushion.position.set(0, 0.1, 0);
            group.add(cushion);
            return group;
        }

        // OLIVE VELVET SOFA - Low-profile tufted sofa
        function createOliveSofa() {
            const group = new THREE.Group();
            const mat = new THREE.MeshLambertMaterial({ color: 0x6b8e23 }); // Olive green
            // Seat
            const seat = new THREE.Mesh(new THREE.BoxGeometry(2.0, 0.25, 0.9), mat);
            seat.position.set(0, 0.2, 0);
            group.add(seat);
            // Low back
            const back = new THREE.Mesh(new THREE.BoxGeometry(2.0, 0.35, 0.15), mat);
            back.position.set(0, 0.45, -0.4);
            group.add(back);
            // Rounded arms
            const armMat = new THREE.MeshLambertMaterial({ color: 0x5a7d1a });
            const armL = new THREE.Mesh(new THREE.CylinderGeometry(0.12, 0.12, 0.9, 12), armMat);
            armL.rotation.x = Math.PI / 2;
            armL.position.set(-0.95, 0.3, 0);
            group.add(armL);
            const armR = new THREE.Mesh(new THREE.CylinderGeometry(0.12, 0.12, 0.9, 12), armMat);
            armR.rotation.x = Math.PI / 2;
            armR.position.set(0.95, 0.3, 0);
            group.add(armR);
            // Tufting buttons
            for (let x = -0.6; x <= 0.6; x += 0.4) {
                for (let z = -0.2; z <= 0.2; z += 0.4) {
                    const btn = new THREE.Mesh(
                        new THREE.CylinderGeometry(0.02, 0.02, 0.02, 8),
                        new THREE.MeshLambertMaterial({ color: 0x333333 })
                    );
                    btn.position.set(x, 0.34, z);
                    group.add(btn);
                }
            }
            return group;
        }

        // PINK VELVET ARMCHAIR
        function createPinkArmchair() {
            const group = new THREE.Group();
            const mat = new THREE.MeshLambertMaterial({ color: 0xe91e63 }); // Pink
            // Seat
            const seat = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.2, 0.7), mat);
            seat.position.set(0, 0.25, 0);
            group.add(seat);
            // Back - curved
            const back = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.6, 0.1), mat);
            back.position.set(0, 0.6, -0.3);
            group.add(back);
            // Arms
            const armL = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.3, 0.6), mat);
            armL.position.set(-0.35, 0.4, 0);
            group.add(armL);
            const armR = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.3, 0.6), mat);
            armR.position.set(0.35, 0.4, 0);
            group.add(armR);
            // Legs - wooden
            const legMat = new THREE.MeshLambertMaterial({ color: 0x8b4513 });
            [[-0.25, -0.25], [-0.25, 0.25], [0.25, -0.25], [0.25, 0.25]].forEach(([x, z]) => {
                const leg = new THREE.Mesh(new THREE.CylinderGeometry(0.03, 0.02, 0.15, 8), legMat);
                leg.position.set(x, 0.075, z);
                group.add(leg);
            });
            return group;
        }

        // BOOK DISPLAYS & STORAGE
        function createWallBookcase() {
            const group = new THREE.Group();
            const woodMat = new THREE.MeshLambertMaterial({ color: 0xd4a76a });
            // Back panel
            const back = new THREE.Mesh(new THREE.BoxGeometry(1.2, 1.8, 0.03), woodMat);
            back.position.set(0, 0.9, -0.15);
            group.add(back);
            // Shelves
            for (let y = 0.15; y <= 1.65; y += 0.3) {
                const shelf = new THREE.Mesh(new THREE.BoxGeometry(1.2, 0.03, 0.3), woodMat);
                shelf.position.set(0, y, 0);
                group.add(shelf);
                // Add some books
                const bookColors = [0xc41e3a, 0x1a3a5c, 0xfdd835, 0x4caf50, 0x9c27b0];
                for (let i = 0; i < 5; i++) {
                    const book = new THREE.Mesh(
                        new THREE.BoxGeometry(0.05 + Math.random() * 0.03, 0.2 + Math.random() * 0.05, 0.15),
                        new THREE.MeshLambertMaterial({ color: bookColors[i % bookColors.length] })
                    );
                    book.position.set(-0.45 + i * 0.2, y + 0.12, 0);
                    group.add(book);
                }
            }
            // Sides
            const sideL = new THREE.Mesh(new THREE.BoxGeometry(0.03, 1.8, 0.3), woodMat);
            sideL.position.set(-0.6, 0.9, 0);
            group.add(sideL);
            const sideR = new THREE.Mesh(new THREE.BoxGeometry(0.03, 1.8, 0.3), woodMat);
            sideR.position.set(0.6, 0.9, 0);
            group.add(sideR);
            return group;
        }

        function createBookCubby() {
            const group = new THREE.Group();
            const woodMat = new THREE.MeshLambertMaterial({ color: 0xdeb887 }); // Light wood
            // Create cubby grid
            const cubbies = 3;
            const cubbySize = 0.35;
            for (let x = 0; x < cubbies; x++) {
                for (let y = 0; y < cubbies; y++) {
                    // Cubby box
                    const box = new THREE.Mesh(
                        new THREE.BoxGeometry(cubbySize, cubbySize, 0.3),
                        woodMat
                    );
                    box.position.set((x - 1) * (cubbySize + 0.02), y * (cubbySize + 0.02) + cubbySize/2, 0);
                    group.add(box);
                    // Random content
                    if (Math.random() > 0.3) {
                        const content = new THREE.Mesh(
                            new THREE.BoxGeometry(cubbySize * 0.8, cubbySize * 0.7, 0.15),
                            new THREE.MeshLambertMaterial({ color: [0xc41e3a, 0x1a3a5c, 0xfdd835, 0x4caf50][Math.floor(Math.random() * 4)] })
                        );
                        content.position.set((x - 1) * (cubbySize + 0.02), y * (cubbySize + 0.02) + cubbySize/2, 0.05);
                        group.add(content);
                    }
                }
            }
            return group;
        }

        function createMagazineRack() {
            const group = new THREE.Group();
            const wireMat = new THREE.MeshLambertMaterial({ color: 0x333333 });
            // Wire frame
            for (let i = 0; i < 4; i++) {
                const wire = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.01, 0.01, 0.6, 8),
                    wireMat
                );
                wire.rotation.z = Math.PI / 6;
                wire.position.set(-0.15 + i * 0.1, 0.35, 0);
                group.add(wire);
            }
            // Base
            const base = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.02, 0.2), wireMat);
            base.position.set(0, 0.02, 0);
            group.add(base);
            // Magazines
            const magColors = [0xff6b6b, 0x45b7d1, 0xfdd835, 0x4caf50];
            for (let i = 0; i < 4; i++) {
                const mag = new THREE.Mesh(
                    new THREE.BoxGeometry(0.02, 0.28, 0.2),
                    new THREE.MeshLambertMaterial({ color: magColors[i] })
                );
                mag.rotation.z = Math.PI / 6;
                mag.position.set(-0.12 + i * 0.08, 0.25 + i * 0.03, 0);
                group.add(mag);
            }
            return group;
        }

        function createBookStack() {
            const group = new THREE.Group();
            const colors = [0xc41e3a, 0x1a3a5c, 0xfdd835, 0x4caf50, 0x9c27b0, 0xff6b6b];
            let y = 0;
            for (let i = 0; i < 5; i++) {
                const book = new THREE.Mesh(
                    new THREE.BoxGeometry(0.2 + Math.random() * 0.05, 0.03 + Math.random() * 0.02, 0.15),
                    new THREE.MeshLambertMaterial({ color: colors[i % colors.length] })
                );
                book.position.set((Math.random() - 0.5) * 0.03, y + 0.015, 0);
                book.rotation.y = (Math.random() - 0.5) * 0.2;
                group.add(book);
                y += 0.035;
            }
            return group;
        }

        function createColorDisplay(color) {
            const group = new THREE.Group();
            const mat = new THREE.MeshLambertMaterial({ color });
            // Pedestal display
            const base = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.6, 0.4), mat);
            base.position.set(0, 0.3, 0);
            group.add(base);
            // Books on top
            const bookMat = new THREE.MeshLambertMaterial({ color: 0x1a1a1a });
            for (let i = 0; i < 3; i++) {
                const book = new THREE.Mesh(new THREE.BoxGeometry(0.18, 0.04, 0.12), bookMat);
                book.position.set(-0.1 + i * 0.1, 0.62 + i * 0.04, 0);
                book.rotation.y = (Math.random() - 0.5) * 0.3;
                group.add(book);
            }
            return group;
        }

        function createLeaningShelf() {
            const group = new THREE.Group();
            const woodMat = new THREE.MeshLambertMaterial({ color: 0xd4a76a });
            // Leaning frame
            const angle = Math.PI / 12;
            for (let side = -1; side <= 1; side += 2) {
                const leg = new THREE.Mesh(new THREE.BoxGeometry(0.04, 1.5, 0.04), woodMat);
                leg.position.set(side * 0.4, 0.7, -0.1);
                leg.rotation.x = -angle;
                group.add(leg);
            }
            // Shelves
            for (let i = 0; i < 4; i++) {
                const shelf = new THREE.Mesh(new THREE.BoxGeometry(0.8, 0.02, 0.25), woodMat);
                shelf.position.set(0, 0.2 + i * 0.35, -0.05 - i * 0.08);
                group.add(shelf);
            }
            return group;
        }

        // RUGS - Layered Persian & African
        function createLayeredRug(width, depth, color) {
            const group = new THREE.Group();
            const rugMat = new THREE.MeshLambertMaterial({ color });
            const rug = new THREE.Mesh(new THREE.BoxGeometry(width, 0.02, depth), rugMat);
            rug.position.set(0, 0.01, 0);
            group.add(rug);
            // Border
            const borderMat = new THREE.MeshLambertMaterial({ color: darkenColor(color, 0.3) });
            const borderW = 0.08;
            const borderT = new THREE.Mesh(new THREE.BoxGeometry(width, 0.025, borderW), borderMat);
            borderT.position.set(0, 0.012, depth/2 - borderW/2);
            group.add(borderT);
            const borderB = new THREE.Mesh(new THREE.BoxGeometry(width, 0.025, borderW), borderMat);
            borderB.position.set(0, 0.012, -depth/2 + borderW/2);
            group.add(borderB);
            const borderL = new THREE.Mesh(new THREE.BoxGeometry(borderW, 0.025, depth), borderMat);
            borderL.position.set(-width/2 + borderW/2, 0.012, 0);
            group.add(borderL);
            const borderR = new THREE.Mesh(new THREE.BoxGeometry(borderW, 0.025, depth), borderMat);
            borderR.position.set(width/2 - borderW/2, 0.012, 0);
            group.add(borderR);
            return group;
        }

        function darkenColor(color, amount) {
            const r = ((color >> 16) & 255) * (1 - amount);
            const g = ((color >> 8) & 255) * (1 - amount);
            const b = (color & 255) * (1 - amount);
            return (Math.floor(r) << 16) | (Math.floor(g) << 8) | Math.floor(b);
        }

        // NATTE PLASTIQUE - Senegalese woven plastic mat (checkered pattern)
        function createAfricanNatte() {
            const group = new THREE.Group();
            const width = 2.2, depth = 1.6;
            // Base mat
            const baseMat = new THREE.MeshLambertMaterial({ color: 0x1a1a1a });
            const base = new THREE.Mesh(new THREE.BoxGeometry(width, 0.015, depth), baseMat);
            base.position.set(0, 0.008, 0);
            group.add(base);
            // Checkered pattern (like Senegalese nattes plastiques)
            const colors = [0xff1493, 0x00ced1, 0xffd700, 0xf5f0e8, 0xff6b6b, 0x32cd32];
            const squareSize = 0.15;
            const cols = Math.floor(width / squareSize);
            const rows = Math.floor(depth / squareSize);
            for (let x = 0; x < cols; x++) {
                for (let z = 0; z < rows; z++) {
                    if ((x + z) % 2 === 0) {
                        const color = colors[(x + z * 2) % colors.length];
                        const square = new THREE.Mesh(
                            new THREE.BoxGeometry(squareSize * 0.9, 0.018, squareSize * 0.9),
                            new THREE.MeshLambertMaterial({ color })
                        );
                        square.position.set(
                            -width/2 + squareSize/2 + x * squareSize,
                            0.01,
                            -depth/2 + squareSize/2 + z * squareSize
                        );
                        group.add(square);
                    }
                }
            }
            return group;
        }

        function createCheckeredRug(color1, color2) {
            const group = new THREE.Group();
            const size = 0.3;
            const count = 6;
            for (let x = 0; x < count; x++) {
                for (let z = 0; z < count; z++) {
                    const color = (x + z) % 2 === 0 ? color1 : color2;
                    const tile = new THREE.Mesh(
                        new THREE.BoxGeometry(size, 0.02, size),
                        new THREE.MeshLambertMaterial({ color })
                    );
                    tile.position.set((x - count/2 + 0.5) * size, 0.01, (z - count/2 + 0.5) * size);
                    group.add(tile);
                }
            }
            return group;
        }

        function createWaxPrintRug(color1, color2) {
            const group = new THREE.Group();
            const width = 2.0, depth = 1.5;
            // Base
            const base = new THREE.Mesh(
                new THREE.BoxGeometry(width, 0.02, depth),
                new THREE.MeshLambertMaterial({ color: color1 })
            );
            base.position.set(0, 0.01, 0);
            group.add(base);
            // African wax print pattern - circular motifs
            for (let x = -0.6; x <= 0.6; x += 0.4) {
                for (let z = -0.4; z <= 0.4; z += 0.4) {
                    const circle = new THREE.Mesh(
                        new THREE.CylinderGeometry(0.12, 0.12, 0.025, 16),
                        new THREE.MeshLambertMaterial({ color: color2 })
                    );
                    circle.position.set(x, 0.012, z);
                    group.add(circle);
                    // Inner circle
                    const inner = new THREE.Mesh(
                        new THREE.CylinderGeometry(0.06, 0.06, 0.027, 12),
                        new THREE.MeshLambertMaterial({ color: color1 })
                    );
                    inner.position.set(x, 0.014, z);
                    group.add(inner);
                }
            }
            return group;
        }

        function createGeometricRug() {
            const group = new THREE.Group();
            const width = 2.2, depth = 1.6;
            // Base - cream
            const base = new THREE.Mesh(
                new THREE.BoxGeometry(width, 0.02, depth),
                new THREE.MeshLambertMaterial({ color: 0xf5f0e8 })
            );
            base.position.set(0, 0.01, 0);
            group.add(base);
            // Black geometric triangles
            const triMat = new THREE.MeshLambertMaterial({ color: 0x1a1a1a });
            const triShape = new THREE.Shape();
            triShape.moveTo(0, 0.15);
            triShape.lineTo(-0.1, 0);
            triShape.lineTo(0.1, 0);
            triShape.lineTo(0, 0.15);
            const triGeo = new THREE.ShapeGeometry(triShape);
            for (let x = -0.7; x <= 0.7; x += 0.35) {
                for (let z = -0.5; z <= 0.5; z += 0.3) {
                    const tri = new THREE.Mesh(triGeo, triMat);
                    tri.rotation.x = -Math.PI / 2;
                    tri.position.set(x, 0.012, z);
                    if (Math.random() > 0.5) tri.rotation.z = Math.PI;
                    group.add(tri);
                }
            }
            return group;
        }

        function createTieDyeCloth() {
            const group = new THREE.Group();
            // Table-sized cloth
            const cloth = new THREE.Mesh(
                new THREE.BoxGeometry(1.8, 0.01, 0.8),
                new THREE.MeshLambertMaterial({ color: 0x4169e1 })
            );
            cloth.position.set(0, 0.72, 0);
            group.add(cloth);
            // Tie-dye circles
            const dyeColors = [0xffffff, 0x9c27b0, 0x00bcd4];
            for (let i = 0; i < 5; i++) {
                const circle = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.1 + Math.random() * 0.1, 0.1, 0.015, 12),
                    new THREE.MeshLambertMaterial({ color: dyeColors[i % dyeColors.length] })
                );
                circle.position.set(-0.6 + i * 0.3, 0.725, (Math.random() - 0.5) * 0.4);
                group.add(circle);
            }
            return group;
        }

        // LIGHTING - Ethiopian & Disco
        function createEthiopianLamp() {
            const group = new THREE.Group();
            // Woven basket shade
            const shadeMat = new THREE.MeshLambertMaterial({ color: 0xd4a76a, side: THREE.DoubleSide });
            const shade = new THREE.Mesh(
                new THREE.ConeGeometry(0.25, 0.35, 12, 1, true),
                shadeMat
            );
            shade.position.set(0, 0, 0);
            shade.rotation.x = Math.PI;
            group.add(shade);
            // Beaded fringe
            const beadMat = new THREE.MeshLambertMaterial({ color: 0xc41e3a });
            for (let i = 0; i < 12; i++) {
                const angle = (i / 12) * Math.PI * 2;
                for (let j = 0; j < 4; j++) {
                    const bead = new THREE.Mesh(
                        new THREE.SphereGeometry(0.015, 6, 6),
                        j % 2 === 0 ? beadMat : new THREE.MeshLambertMaterial({ color: 0xfdd835 })
                    );
                    bead.position.set(
                        Math.cos(angle) * 0.23,
                        -0.38 - j * 0.04,
                        Math.sin(angle) * 0.23
                    );
                    group.add(bead);
                }
            }
            // Cord
            const cord = new THREE.Mesh(
                new THREE.CylinderGeometry(0.01, 0.01, 0.5, 8),
                new THREE.MeshLambertMaterial({ color: 0x8b4513 })
            );
            cord.position.set(0, 0.42, 0);
            group.add(cord);
            return group;
        }

        function createBeadedLamp() {
            const group = new THREE.Group();
            // Cylinder shade
            const shadeMat = new THREE.MeshLambertMaterial({ color: 0xf5f5dc, side: THREE.DoubleSide });
            const shade = new THREE.Mesh(
                new THREE.CylinderGeometry(0.15, 0.2, 0.3, 12, 1, true),
                shadeMat
            );
            shade.position.set(0, 0, 0);
            group.add(shade);
            // Colorful beads hanging
            const beadColors = [0xc41e3a, 0xfdd835, 0x4caf50, 0x2196f3, 0x9c27b0];
            for (let i = 0; i < 16; i++) {
                const angle = (i / 16) * Math.PI * 2;
                const color = beadColors[i % beadColors.length];
                for (let j = 0; j < 6; j++) {
                    const bead = new THREE.Mesh(
                        new THREE.SphereGeometry(0.012, 6, 6),
                        new THREE.MeshLambertMaterial({ color })
                    );
                    bead.position.set(
                        Math.cos(angle) * 0.18,
                        -0.18 - j * 0.025,
                        Math.sin(angle) * 0.18
                    );
                    group.add(bead);
                }
            }
            // Cord
            const cord = new THREE.Mesh(
                new THREE.CylinderGeometry(0.01, 0.01, 0.4, 8),
                new THREE.MeshLambertMaterial({ color: 0x333333 })
            );
            cord.position.set(0, 0.35, 0);
            group.add(cord);
            return group;
        }

        function createDiscoBallCluster() {
            const group = new THREE.Group();
            const ballMat = new THREE.MeshLambertMaterial({ color: 0xc0c0c0 });
            const cordMat = new THREE.MeshLambertMaterial({ color: 0x333333 });
            // Multiple balls at different heights
            const positions = [
                { x: 0, y: 0, z: 0, size: 0.15, cordLen: 0.3 },
                { x: 0.25, y: 0.15, z: 0.1, size: 0.1, cordLen: 0.15 },
                { x: -0.2, y: 0.1, z: -0.1, size: 0.12, cordLen: 0.2 },
                { x: 0.1, y: -0.1, z: 0.2, size: 0.08, cordLen: 0.4 }
            ];
            positions.forEach(p => {
                const ball = new THREE.Mesh(new THREE.SphereGeometry(p.size, 12, 12), ballMat);
                ball.position.set(p.x, p.y, p.z);
                group.add(ball);
                const cord = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.008, 0.008, p.cordLen, 8),
                    cordMat
                );
                cord.position.set(p.x, p.y + p.size + p.cordLen/2, p.z);
                group.add(cord);
            });
            return group;
        }

        function createStringLights() {
            const group = new THREE.Group();
            const wireMat = new THREE.MeshLambertMaterial({ color: 0x333333 });
            const bulbColors = [0xfdd835, 0xff6b6b, 0x4caf50, 0x2196f3, 0x9c27b0];
            // Wire
            const points = [];
            for (let i = 0; i <= 10; i++) {
                points.push(new THREE.Vector3(
                    -1.5 + i * 0.3,
                    Math.sin(i * 0.5) * 0.1,
                    0
                ));
            }
            // Bulbs along the wire
            for (let i = 0; i < 10; i++) {
                const bulb = new THREE.Mesh(
                    new THREE.SphereGeometry(0.03, 8, 8),
                    new THREE.MeshLambertMaterial({ color: bulbColors[i % bulbColors.length], emissive: bulbColors[i % bulbColors.length], emissiveIntensity: 0.3 })
                );
                bulb.position.set(-1.5 + i * 0.3, Math.sin(i * 0.5) * 0.1 - 0.05, 0);
                group.add(bulb);
                // Wire segment
                if (i < 9) {
                    const wire = new THREE.Mesh(
                        new THREE.CylinderGeometry(0.005, 0.005, 0.3, 6),
                        wireMat
                    );
                    wire.position.set(-1.35 + i * 0.3, Math.sin(i * 0.5 + 0.25) * 0.1, 0);
                    wire.rotation.z = Math.PI / 2;
                    group.add(wire);
                }
            }
            return group;
        }

        function createPaperLantern() {
            const group = new THREE.Group();
            const lanternMat = new THREE.MeshLambertMaterial({
                color: 0xfff8e1,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.9
            });
            const lantern = new THREE.Mesh(
                new THREE.SphereGeometry(0.2, 16, 12),
                lanternMat
            );
            lantern.scale.set(1, 1.2, 1);
            lantern.position.set(0, 0, 0);
            group.add(lantern);
            // Wire frame rings
            const wireMat = new THREE.MeshLambertMaterial({ color: 0x333333 });
            for (let i = -0.15; i <= 0.15; i += 0.1) {
                const ring = new THREE.Mesh(
                    new THREE.TorusGeometry(0.18, 0.005, 8, 16),
                    wireMat
                );
                ring.position.set(0, i, 0);
                ring.rotation.x = Math.PI / 2;
                group.add(ring);
            }
            // Cord
            const cord = new THREE.Mesh(
                new THREE.CylinderGeometry(0.01, 0.01, 0.3, 8),
                wireMat
            );
            cord.position.set(0, 0.38, 0);
            group.add(cord);
            return group;
        }

        // PLANTS & AFRICAN DECOR
        function createPalmPlant() {
            const group = new THREE.Group();
            // Pot
            const potMat = new THREE.MeshLambertMaterial({ color: 0x8b4513 });
            const pot = new THREE.Mesh(new THREE.CylinderGeometry(0.15, 0.12, 0.25, 12), potMat);
            pot.position.set(0, 0.125, 0);
            group.add(pot);
            // Soil
            const soil = new THREE.Mesh(
                new THREE.CylinderGeometry(0.14, 0.14, 0.03, 12),
                new THREE.MeshLambertMaterial({ color: 0x3e2723 })
            );
            soil.position.set(0, 0.24, 0);
            group.add(soil);
            // Palm fronds
            const leafMat = new THREE.MeshLambertMaterial({ color: 0x2e7d32, side: THREE.DoubleSide });
            for (let i = 0; i < 6; i++) {
                const angle = (i / 6) * Math.PI * 2;
                const leaf = new THREE.Mesh(
                    new THREE.BoxGeometry(0.08, 0.5, 0.01),
                    leafMat
                );
                leaf.position.set(
                    Math.cos(angle) * 0.1,
                    0.5,
                    Math.sin(angle) * 0.1
                );
                leaf.rotation.x = -0.5;
                leaf.rotation.y = angle;
                leaf.rotation.z = 0.3;
                group.add(leaf);
            }
            return group;
        }

        function createHangingPlant() {
            const group = new THREE.Group();
            // Macrame holder
            const cordMat = new THREE.MeshLambertMaterial({ color: 0xf5f5dc });
            for (let i = 0; i < 4; i++) {
                const angle = (i / 4) * Math.PI * 2;
                const cord = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.008, 0.008, 0.4, 6),
                    cordMat
                );
                cord.position.set(Math.cos(angle) * 0.1, 0.2, Math.sin(angle) * 0.1);
                group.add(cord);
            }
            // Pot
            const pot = new THREE.Mesh(
                new THREE.CylinderGeometry(0.12, 0.1, 0.15, 12),
                new THREE.MeshLambertMaterial({ color: 0xd4a76a })
            );
            pot.position.set(0, 0, 0);
            group.add(pot);
            // Trailing vines
            const vineMat = new THREE.MeshLambertMaterial({ color: 0x4caf50 });
            for (let i = 0; i < 5; i++) {
                const angle = (i / 5) * Math.PI * 2;
                for (let j = 0; j < 4; j++) {
                    const leaf = new THREE.Mesh(
                        new THREE.SphereGeometry(0.025, 6, 6),
                        vineMat
                    );
                    leaf.position.set(
                        Math.cos(angle) * (0.12 + j * 0.03),
                        -0.1 - j * 0.08,
                        Math.sin(angle) * (0.12 + j * 0.03)
                    );
                    group.add(leaf);
                }
            }
            return group;
        }

        function createPothosVine() {
            const group = new THREE.Group();
            // Small pot
            const pot = new THREE.Mesh(
                new THREE.CylinderGeometry(0.08, 0.06, 0.1, 10),
                new THREE.MeshLambertMaterial({ color: 0xffffff })
            );
            pot.position.set(0, 0.05, 0);
            group.add(pot);
            // Trailing vine with heart-shaped leaves
            const leafMat = new THREE.MeshLambertMaterial({ color: 0x66bb6a });
            const vineMat = new THREE.MeshLambertMaterial({ color: 0x2e7d32 });
            for (let v = 0; v < 3; v++) {
                const angle = (v / 3) * Math.PI * 2;
                for (let i = 0; i < 6; i++) {
                    // Vine segment
                    const vine = new THREE.Mesh(
                        new THREE.CylinderGeometry(0.005, 0.005, 0.08, 6),
                        vineMat
                    );
                    vine.position.set(
                        Math.cos(angle) * 0.06 + Math.sin(i) * 0.02,
                        -i * 0.06,
                        Math.sin(angle) * 0.06
                    );
                    vine.rotation.z = 0.3;
                    group.add(vine);
                    // Leaf
                    const leaf = new THREE.Mesh(
                        new THREE.SphereGeometry(0.03, 6, 6),
                        leafMat
                    );
                    leaf.scale.set(1, 0.3, 1.2);
                    leaf.position.set(
                        Math.cos(angle) * 0.08 + Math.sin(i) * 0.03,
                        -i * 0.06 - 0.02,
                        Math.sin(angle) * 0.08
                    );
                    group.add(leaf);
                }
            }
            return group;
        }

        function createWovenBasket() {
            const group = new THREE.Group();
            const basketMat = new THREE.MeshLambertMaterial({ color: 0xd4a76a });
            const basket = new THREE.Mesh(
                new THREE.CylinderGeometry(0.2, 0.15, 0.25, 16),
                basketMat
            );
            basket.position.set(0, 0.125, 0);
            group.add(basket);
            // Weave pattern stripes
            const stripeMat = new THREE.MeshLambertMaterial({ color: 0x8b4513 });
            for (let i = 0; i < 4; i++) {
                const stripe = new THREE.Mesh(
                    new THREE.TorusGeometry(0.17 - i * 0.01, 0.01, 8, 16),
                    stripeMat
                );
                stripe.position.set(0, 0.05 + i * 0.05, 0);
                stripe.rotation.x = Math.PI / 2;
                group.add(stripe);
            }
            return group;
        }

        function createAfricanPottery() {
            const group = new THREE.Group();
            // Rounded pot with narrow neck
            const potMat = new THREE.MeshLambertMaterial({ color: 0x8b4513 });
            const body = new THREE.Mesh(
                new THREE.SphereGeometry(0.15, 12, 12),
                potMat
            );
            body.scale.set(1, 0.8, 1);
            body.position.set(0, 0.12, 0);
            group.add(body);
            const neck = new THREE.Mesh(
                new THREE.CylinderGeometry(0.06, 0.1, 0.1, 12),
                potMat
            );
            neck.position.set(0, 0.27, 0);
            group.add(neck);
            // Geometric pattern
            const patternMat = new THREE.MeshLambertMaterial({ color: 0xf5f0e8 });
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * Math.PI * 2;
                const dot = new THREE.Mesh(
                    new THREE.SphereGeometry(0.015, 6, 6),
                    patternMat
                );
                dot.position.set(
                    Math.cos(angle) * 0.14,
                    0.12,
                    Math.sin(angle) * 0.14
                );
                group.add(dot);
            }
            return group;
        }

        function createWoodSculpture() {
            const group = new THREE.Group();
            const woodMat = new THREE.MeshLambertMaterial({ color: 0x5d4037 });
            // Abstract figure
            const base = new THREE.Mesh(
                new THREE.CylinderGeometry(0.08, 0.1, 0.05, 12),
                woodMat
            );
            base.position.set(0, 0.025, 0);
            group.add(base);
            const body = new THREE.Mesh(
                new THREE.CylinderGeometry(0.04, 0.06, 0.3, 8),
                woodMat
            );
            body.position.set(0, 0.2, 0);
            group.add(body);
            const head = new THREE.Mesh(
                new THREE.SphereGeometry(0.06, 10, 10),
                woodMat
            );
            head.scale.set(1, 1.3, 0.8);
            head.position.set(0, 0.42, 0);
            group.add(head);
            // Arms
            const armL = new THREE.Mesh(
                new THREE.CylinderGeometry(0.015, 0.015, 0.15, 6),
                woodMat
            );
            armL.position.set(-0.08, 0.25, 0);
            armL.rotation.z = 0.5;
            group.add(armL);
            const armR = new THREE.Mesh(
                new THREE.CylinderGeometry(0.015, 0.015, 0.15, 6),
                woodMat
            );
            armR.position.set(0.08, 0.25, 0);
            armR.rotation.z = -0.5;
            group.add(armR);
            return group;
        }

        // Place item in scene
        container.addEventListener('click', function(event) {
            if (!decoratorMode || !selectedFurnitureType) return;

            const rect = container.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);

            // Check if clicking on existing item
            const itemIntersects = raycaster.intersectObjects(placedItems, true);
            if (itemIntersects.length > 0) {
                let obj = itemIntersects[0].object;
                while (obj.parent && !obj.userData.isPlacedItem) obj = obj.parent;
                if (obj.userData.isPlacedItem) {
                    selectedPlacedItem = obj;
                    selectedFurnitureType = null;
                    document.querySelectorAll('.item-card').forEach(c => c.classList.remove('selected'));
                    updateSelectedInfo();
                    return;
                }
            }

            // Place new item on floor
            const floorPlane = new THREE.Plane(new THREE.Vector3(0, 1, 0), 0);
            const intersectPoint = new THREE.Vector3();
            raycaster.ray.intersectPlane(floorPlane, intersectPoint);

            if (intersectPoint) {
                const item = createFurnitureItem(selectedFurnitureType);

                // SNAP TO FLOOR - ensure Y is always 0 for floor items
                intersectPoint.y = 0;

                // ROOM BOUNDARY CHECK - constrain to valid room areas
                const constrainedPos = constrainToRoom(intersectPoint);
                if (constrainedPos) {
                    item.position.copy(constrainedPos);

                    // Wall art needs to be placed on walls
                    if (item.userData.isWallArt) {
                        item.position.y = 1.5;
                    }

                    scene.add(item);
                    placedItems.push(item);
                } else {
                    console.log('Cannot place item outside room boundaries');
                }
            }
        });

        // ROOM BOUNDARY CONSTRAINT FUNCTION
        // Ensures furniture stays inside room boundaries
        function constrainToRoom(pos) {
            const x = pos.x;
            const z = pos.z;

            // Room S202 boundaries (left room)
            // ROOM_S202_X is center, width is ROOM_S202_WIDTH
            const s202Left = ROOM_S202_X - ROOM_S202_WIDTH / 2 + 0.3;
            const s202Right = ROOM_S202_X + ROOM_S202_WIDTH / 2 - 0.3;
            const s202Front = ROOM_S202_DEPTH / 2 - 0.3;  // South (windows)
            const s202Back = -ROOM_S202_DEPTH / 2 + 0.3;  // North (door)

            // Room S203 boundaries (right room)
            const s203Left = ROOM_S203_X - ROOM_S203_WIDTH / 2 + 0.3;
            const s203Right = ROOM_S203_X + ROOM_S203_WIDTH / 2 - 0.3;
            const s203Front = ROOM_S203_DEPTH / 2 - 0.3;
            const s203Back = -ROOM_S203_DEPTH / 2 + 0.3;

            // Check if in S202
            if (x >= s202Left && x <= s202Right && z >= s202Back && z <= s202Front) {
                // Clamp to room boundaries
                return new THREE.Vector3(
                    Math.max(s202Left, Math.min(s202Right, x)),
                    0,
                    Math.max(s202Back, Math.min(s202Front, z))
                );
            }

            // Check if in S203
            if (x >= s203Left && x <= s203Right && z >= s203Back && z <= s203Front) {
                return new THREE.Vector3(
                    Math.max(s203Left, Math.min(s203Right, x)),
                    0,
                    Math.max(s203Back, Math.min(s203Front, z))
                );
            }

            // Not in any room - find closest room and snap to edge
            const distToS202 = Math.abs(x - ROOM_S202_X);
            const distToS203 = Math.abs(x - ROOM_S203_X);

            if (distToS202 < distToS203) {
                // Snap to S202
                return new THREE.Vector3(
                    Math.max(s202Left, Math.min(s202Right, x)),
                    0,
                    Math.max(s202Back, Math.min(s202Front, z))
                );
            } else {
                // Snap to S203
                return new THREE.Vector3(
                    Math.max(s203Left, Math.min(s203Right, x)),
                    0,
                    Math.max(s203Back, Math.min(s203Front, z))
                );
            }
        }

        window.moveItem = function(dx, dz) {
            if (selectedPlacedItem) {
                const newPos = selectedPlacedItem.position.clone();
                newPos.x += dx;
                newPos.z += dz;
                const constrained = constrainToRoom(newPos);
                if (constrained) {
                    selectedPlacedItem.position.x = constrained.x;
                    selectedPlacedItem.position.z = constrained.z;
                    selectedPlacedItem.position.y = 0; // Snap to floor
                }
            }
        };

        window.rotateItem = function(degrees) {
            if (selectedPlacedItem) {
                selectedPlacedItem.rotation.y += degrees * Math.PI / 180;
            }
        };

        window.deleteItem = function() {
            if (selectedPlacedItem) {
                scene.remove(selectedPlacedItem);
                placedItems = placedItems.filter(i => i !== selectedPlacedItem);
                selectedPlacedItem = null;
                updateSelectedInfo();
            }
        };

        window.saveLayout = async function() {
            const layout = placedItems.map(item => ({
                type: item.userData.itemType,
                position: { x: item.position.x, y: item.position.y, z: item.position.z },
                rotation: { y: item.rotation.y }
            }));

            // Save to localStorage as backup
            localStorage.setItem('panafricanLibraryLayout', JSON.stringify(layout));

            // Also save to Vercel Blob for persistent shared storage
            try {
                const response = await fetch('/api/layout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(layout)
                });
                const result = await response.json();
                if (result.success) {
                    alert('Layout saved! This layout will be visible to all visitors.');
                } else {
                    alert('Layout saved locally. Cloud sync failed: ' + (result.error || 'Unknown error'));
                }
            } catch (err) {
                console.error('Cloud save error:', err);
                alert('Layout saved locally. Cloud sync unavailable.');
            }
        };

        window.loadLayout = async function() {
            try {
                // First try to load from Vercel Blob (shared layout)
                const response = await fetch('/api/layout');
                const result = await response.json();

                if (result.success && result.layout && result.layout.length > 0) {
                    applyLayout(result.layout);
                    alert('Shared layout loaded from cloud!');
                    return;
                }
            } catch (err) {
                console.error('Cloud load error:', err);
            }

            // Fallback to localStorage
            const saved = localStorage.getItem('panafricanLibraryLayout');
            if (saved) {
                const layout = JSON.parse(saved);
                applyLayout(layout);
                alert('Layout loaded from local storage.');
            } else {
                alert('No saved layout found.');
            }
        };

        function applyLayout(layout) {
            // Clear existing placed items
            placedItems.forEach(item => scene.remove(item));
            placedItems = [];
            // Recreate items
            layout.forEach(data => {
                const item = createFurnitureItem(data.type);
                item.position.set(data.position.x, data.position.y, data.position.z);
                item.rotation.y = data.rotation.y;
                scene.add(item);
                placedItems.push(item);
            });
        }

        // Auto-load shared layout on page load
        async function autoLoadLayout() {
            try {
                const response = await fetch('/api/layout');
                const result = await response.json();

                if (result.success && result.layout && result.layout.length > 0) {
                    applyLayout(result.layout);
                    console.log('Auto-loaded shared layout from cloud');
                }
            } catch (err) {
                // Silently fail - just use empty layout
                console.log('No shared layout available');
            }
        }

        // Call autoLoadLayout after scene is ready
        setTimeout(autoLoadLayout, 1000);

        window.resetLayout = function() {
            if (confirm('Reset to default layout? This will remove all placed items.')) {
                placedItems.forEach(item => scene.remove(item));
                placedItems = [];
                deselectAll();
            }
        };

        window.exportLayout = function() {
            const layout = placedItems.map(item => ({
                type: item.userData.itemType,
                position: { x: item.position.x, y: item.position.y, z: item.position.z },
                rotation: { y: item.rotation.y }
            }));
            const blob = new Blob([JSON.stringify(layout, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'panafrican-library-layout.json';
            a.click();
        };

        // Wall visibility based on camera position
        function updateWallVisibility() {
            if (!hideNearWall) {
                // Show all walls
                Object.values(roomS202Walls).forEach(w => { if (w) w.visible = true; });
                Object.values(roomS203Walls).forEach(w => { if (w) w.visible = true; });
                return;
            }

            // Determine which wall is closest to camera
            const camX = camera.position.x;
            const camZ = camera.position.z;

            // Room S202 walls
            // FRONT wall (windows) - hide when camera is in front (positive Z)
            if (roomS202Walls.front) roomS202Walls.front.visible = camZ < ROOM_S202_DEPTH / 4;

            // BACK wall (corridor entry) - hide when camera is behind (negative Z)
            // Also hide entire vestibule (all corridor walls) when hiding back area
            const hideBackArea = camZ < -ROOM_S202_DEPTH / 4;
            if (roomS202Walls.back) roomS202Walls.back.visible = !hideBackArea;
            if (roomS202Walls.vestibuleGroup) roomS202Walls.vestibuleGroup.visible = !hideBackArea;

            // LEFT wall (Three Star door) - hide when camera is to the left
            if (roomS202Walls.left) roomS202Walls.left.visible = camX > ROOM_S202_X - ROOM_S202_WIDTH / 2;

            // RIGHT wall (solid shared wall with S203) - hide when camera is to the right
            if (roomS202Walls.right) roomS202Walls.right.visible = camX < ROOM_S202_X + ROOM_S202_WIDTH / 2;

            // Room S203 walls
            // FRONT wall (windows) - hide when camera is in front
            if (roomS203Walls.front) roomS203Walls.front.visible = camZ < ROOM_S203_DEPTH / 4;

            // BACK wall (corridor entry + poster wall) - hide when camera is behind
            if (roomS203Walls.back) roomS203Walls.back.visible = camZ > -ROOM_S203_DEPTH / 4;

            // LEFT wall (solid shared wall with S202) - hide when camera is to the left
            if (roomS203Walls.left) roomS203Walls.left.visible = camX > ROOM_S203_X - ROOM_S203_WIDTH / 2;

            // RIGHT wall (solid exterior) - hide when camera is to the right
            if (roomS203Walls.right) roomS203Walls.right.visible = camX < ROOM_S203_X + ROOM_S203_WIDTH / 2;
        }

        // Auto ceiling visibility based on camera height
        function updateCeilingVisibility() {
            const camY = camera.position.y;
            const isAbove = camY > CEILING_HEIGHT + 1;

            if (showCeiling) {
                // Auto-hide ceiling when viewing from above
                scene.traverse((obj) => {
                    if (obj.userData.isCeiling) {
                        obj.visible = !isAbove;
                    }
                });
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            currentRotationX += (targetRotationX - currentRotationX) * 0.05;
            currentRotationY += (targetRotationY - currentRotationY) * 0.05;

            if (keys['w']) cameraTarget.z -= 0.1;
            if (keys['s']) cameraTarget.z += 0.1;
            if (keys['a']) cameraTarget.x -= 0.1;
            if (keys['d']) cameraTarget.x += 0.1;

            camera.position.x = cameraTarget.x + Math.sin(currentRotationX) * Math.cos(currentRotationY) * cameraDistance;
            camera.position.y = cameraTarget.y + Math.sin(currentRotationY) * cameraDistance;
            camera.position.z = cameraTarget.z + Math.cos(currentRotationX) * Math.cos(currentRotationY) * cameraDistance;
            camera.lookAt(cameraTarget);

            updateWallVisibility();
            updateCeilingVisibility();

            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // ========== ADMIN SYSTEM ==========
        let adminUser = null;
        let adminToken = null;
        let selectedRenderStyle = 'photorealistic';

        // Check for saved admin session
        const savedAdmin = localStorage.getItem('panafricanAdmin');
        if (savedAdmin) {
            try {
                const data = JSON.parse(savedAdmin);
                adminUser = data.email;
                adminToken = data.token;
                document.getElementById('admin-btn').classList.add('logged-in');
                document.getElementById('admin-btn').textContent = 'ğŸ‘¤ ' + (data.name || 'Admin');
            } catch(e) {}
        }

        window.toggleAdminLogin = function() {
            if (adminUser) {
                toggleAdminPanel();
            } else {
                document.getElementById('login-modal').classList.add('visible');
                document.getElementById('login-email').focus();
            }
        };

        window.closeLoginModal = function() {
            document.getElementById('login-modal').classList.remove('visible');
            document.getElementById('login-email').value = '';
            document.getElementById('login-error').textContent = '';
        };

        window.attemptLogin = async function() {
            const email = document.getElementById('login-email').value.trim();
            if (!email) {
                document.getElementById('login-error').textContent = 'Please enter your email';
                return;
            }

            try {
                const response = await fetch('/api/auth', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                const result = await response.json();

                if (result.success && result.isAdmin) {
                    adminUser = result.email;
                    adminToken = result.token;
                    localStorage.setItem('panafricanAdmin', JSON.stringify({
                        email: result.email,
                        token: result.token,
                        name: result.name
                    }));
                    document.getElementById('admin-btn').classList.add('logged-in');
                    document.getElementById('admin-btn').textContent = 'ğŸ‘¤ ' + result.name;
                    document.getElementById('admin-user-name').textContent = 'Logged in as: ' + result.name;
                    closeLoginModal();
                    toggleAdminPanel();
                    loadAdminConfigs();
                } else {
                    document.getElementById('login-error').textContent = 'Not an authorized admin email';
                }
            } catch (err) {
                document.getElementById('login-error').textContent = 'Login failed: ' + err.message;
            }
        };

        window.logoutAdmin = function() {
            adminUser = null;
            adminToken = null;
            localStorage.removeItem('panafricanAdmin');
            document.getElementById('admin-btn').classList.remove('logged-in');
            document.getElementById('admin-btn').textContent = 'ğŸ” Admin';
            document.getElementById('admin-panel').classList.remove('open');
        };

        window.toggleAdminPanel = function() {
            if (!adminUser) {
                toggleAdminLogin();
                return;
            }
            const panel = document.getElementById('admin-panel');
            panel.classList.toggle('open');
            if (panel.classList.contains('open')) {
                loadAdminConfigs();
                updateCameraPositionDisplay();
            }
        };

        window.switchAdminTab = function(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.querySelectorAll('.admin-content').forEach(c => c.style.display = 'none');
            document.getElementById('admin-tab-' + tab).style.display = 'block';
        };

        function updateCameraPositionDisplay() {
            const display = document.getElementById('camera-position-display');
            if (display) {
                display.innerHTML = `Position: (${camera.position.x.toFixed(2)}, ${camera.position.y.toFixed(2)}, ${camera.position.z.toFixed(2)})<br>Target: (${cameraTarget.x.toFixed(2)}, ${cameraTarget.y.toFixed(2)}, ${cameraTarget.z.toFixed(2)})<br>Distance: ${cameraDistance.toFixed(2)} | RotX: ${currentRotationX.toFixed(2)} | RotY: ${currentRotationY.toFixed(2)}`;
            }
        }

        setInterval(() => {
            if (document.getElementById('admin-panel').classList.contains('open')) {
                updateCameraPositionDisplay();
            }
        }, 500);

        async function loadAdminConfigs() {
            try {
                const layoutRes = await fetch('/api/config?type=layout');
                const layoutData = await layoutRes.json();
                renderConfigList('saved-layouts-list', layoutData.configs || [], 'layout');
            } catch (e) {
                document.getElementById('saved-layouts-list').innerHTML = '<div style="color:#666;font-size:12px;padding:10px;">Failed to load</div>';
            }
            try {
                const viewRes = await fetch('/api/config?type=view');
                const viewData = await viewRes.json();
                renderConfigList('saved-views-list', viewData.configs || [], 'view');
            } catch (e) {
                document.getElementById('saved-views-list').innerHTML = '<div style="color:#666;font-size:12px;padding:10px;">Failed to load</div>';
            }
            try {
                const moodRes = await fetch('/api/config?type=mood');
                const moodData = await moodRes.json();
                renderConfigList('saved-mood-list', moodData.configs || [], 'mood');
            } catch (e) {
                document.getElementById('saved-mood-list').innerHTML = '<div style="color:#666;font-size:12px;padding:10px;">Failed to load</div>';
            }
        }

        function renderConfigList(containerId, configs, type) {
            const container = document.getElementById(containerId);
            if (configs.length === 0) {
                container.innerHTML = '<div style="color:#666;font-size:12px;padding:10px;">No saved ' + type + 's yet</div>';
                return;
            }
            container.innerHTML = configs.map(cfg => `
                <div class="saved-config-item">
                    <div>
                        <div class="saved-config-name">${cfg.name}</div>
                        <div class="saved-config-meta">By ${cfg.author} â€¢ ${new Date(cfg.createdAt).toLocaleDateString()}</div>
                    </div>
                    <div class="saved-config-actions">
                        <button class="saved-config-btn" onclick="loadConfig('${type}', '${cfg.name}')">Load</button>
                        <button class="saved-config-btn danger" onclick="deleteConfig('${type}', '${cfg.name}')">âœ•</button>
                    </div>
                </div>
            `).join('');
        }

        window.saveAdminLayout = async function() {
            const name = document.getElementById('layout-name').value.trim();
            if (!name) { alert('Please enter a layout name'); return; }
            const layout = placedItems.map(item => ({
                type: item.userData.itemType,
                position: { x: item.position.x, y: item.position.y, z: item.position.z },
                rotation: { y: item.rotation.y }
            }));
            try {
                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'layout', name: name, data: layout, author: adminUser || 'Unknown' })
                });
                const result = await response.json();
                if (result.success) {
                    alert('Layout saved!');
                    document.getElementById('layout-name').value = '';
                    loadAdminConfigs();
                }
            } catch (err) { alert('Failed to save layout: ' + err.message); }
        };

        window.saveAdminView = async function() {
            const name = document.getElementById('view-name').value.trim();
            const description = document.getElementById('view-description').value.trim();
            if (!name) { alert('Please enter a view name'); return; }
            const viewData = {
                position: { x: camera.position.x, y: camera.position.y, z: camera.position.z },
                target: { x: cameraTarget.x, y: cameraTarget.y, z: cameraTarget.z },
                distance: cameraDistance,
                rotationX: currentRotationX,
                rotationY: currentRotationY,
                description: description
            };
            try {
                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'view', name: name, data: viewData, author: adminUser || 'Unknown' })
                });
                const result = await response.json();
                if (result.success) {
                    alert('View saved!');
                    document.getElementById('view-name').value = '';
                    document.getElementById('view-description').value = '';
                    loadAdminConfigs();
                }
            } catch (err) { alert('Failed to save view: ' + err.message); }
        };

        window.saveMoodEntry = async function() {
            const title = document.getElementById('mood-title').value.trim();
            const imageUrl = document.getElementById('mood-image-url').value.trim();
            const description = document.getElementById('mood-description').value.trim();
            const category = document.getElementById('mood-category').value;
            if (!title) { alert('Please enter a title'); return; }
            const moodData = { title, imageUrl, description, category };
            try {
                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'mood', name: title, data: moodData, author: adminUser || 'Unknown' })
                });
                const result = await response.json();
                if (result.success) {
                    alert('Mood board entry added!');
                    document.getElementById('mood-title').value = '';
                    document.getElementById('mood-image-url').value = '';
                    document.getElementById('mood-description').value = '';
                    loadAdminConfigs();
                }
            } catch (err) { alert('Failed to save mood entry: ' + err.message); }
        };

        window.loadConfig = async function(type, name) {
            try {
                const response = await fetch(`/api/config?type=${type}&name=${encodeURIComponent(name)}`);
                const result = await response.json();
                if (result.success && result.config) {
                    const data = result.config.data;
                    if (type === 'layout') {
                        applyLayout(data);
                        alert('Layout loaded!');
                    } else if (type === 'view') {
                        cameraTarget.set(data.target.x, data.target.y, data.target.z);
                        cameraDistance = data.distance;
                        targetRotationX = data.rotationX;
                        targetRotationY = data.rotationY;
                        currentRotationX = data.rotationX;
                        currentRotationY = data.rotationY;
                        alert('View loaded: ' + (data.description || name));
                    }
                }
            } catch (err) { alert('Failed to load config: ' + err.message); }
        };

        window.deleteConfig = async function(type, name) {
            if (!confirm(`Delete ${type} "${name}"?`)) return;
            try {
                const response = await fetch('/api/config', {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type, name })
                });
                const result = await response.json();
                if (result.success) loadAdminConfigs();
            } catch (err) { alert('Failed to delete: ' + err.message); }
        };

        window.exportLayoutFile = function() {
            const layout = placedItems.map(item => ({
                type: item.userData.itemType,
                position: { x: item.position.x, y: item.position.y, z: item.position.z },
                rotation: { y: item.rotation.y }
            }));
            const blob = new Blob([JSON.stringify(layout, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'panafrican-library-layout-' + new Date().toISOString().slice(0,10) + '.json';
            a.click();
        };

        // ========== AI RENDER SYSTEM ==========
        let capturedImageData = null;

        window.openRenderModal = function() {
            document.getElementById('render-modal').classList.add('visible');
            captureForRender();
        };

        window.closeRenderModal = function() {
            document.getElementById('render-modal').classList.remove('visible');
            capturedImageData = null;
        };

        window.selectRenderStyle = function(style, btn) {
            selectedRenderStyle = style;
            document.querySelectorAll('.render-style-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        };

        function captureForRender() {
            renderer.render(scene, camera);
            const dataURL = renderer.domElement.toDataURL('image/png');
            capturedImageData = dataURL;
            document.getElementById('render-input-preview').innerHTML = `<img src="${dataURL}" alt="3D Scene">`;
        }

        window.generateRender = async function() {
            if (!capturedImageData) { alert('Please wait for capture'); return; }
            const btn = document.getElementById('generate-render-btn');
            const status = document.getElementById('render-status');
            const statusText = document.getElementById('render-status-text');
            const outputPreview = document.getElementById('render-output-preview');

            btn.disabled = true;
            status.style.display = 'block';
            statusText.textContent = 'Generating photorealistic render... This may take 10-30 seconds';
            outputPreview.innerHTML = '<span class="render-spinner"></span>';

            try {
                const customPrompt = document.getElementById('render-custom-prompt').value.trim();
                const response = await fetch('/api/render', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        imageBase64: capturedImageData,
                        style: selectedRenderStyle,
                        prompt: customPrompt
                    })
                });
                const result = await response.json();
                if (result.success && result.image) {
                    outputPreview.innerHTML = `<img src="${result.image}" alt="AI Render">`;
                    statusText.textContent = 'Render complete!';
                    setTimeout(() => {
                        status.innerHTML = `
                            <button class="admin-btn admin-btn-success" onclick="downloadRender()">ğŸ’¾ Download Render</button>
                            <button class="admin-btn admin-btn-secondary" onclick="captureForRender()">ğŸ”„ Capture New View</button>
                        `;
                    }, 1000);
                    window.lastRenderImage = result.image;
                } else {
                    throw new Error(result.error || result.text || 'Unknown error');
                }
            } catch (err) {
                statusText.textContent = 'Error: ' + err.message;
                outputPreview.innerHTML = 'Generation failed';
            } finally {
                btn.disabled = false;
            }
        };

        window.downloadRender = function() {
            if (!window.lastRenderImage) return;
            const a = document.createElement('a');
            a.href = window.lastRenderImage;
            a.download = 'panafrican-library-render-' + selectedRenderStyle + '-' + new Date().toISOString().slice(0,19).replace(/:/g, '-') + '.png';
            a.click();
        };

    </script>
</body>
</html>
